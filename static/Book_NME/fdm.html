<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 有限差分法 | 数值地球</title>
  <meta name="description" content="这是一本有关数值方法在地球科学应用的书，可以作为数值方法在大气、水文、地貌、地址和环境科学等方面的应用的入门教科书。" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 有限差分法 | 数值地球" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://shud.xyz/Book_NME/image/Cover.jpg" />
  <meta property="og:description" content="这是一本有关数值方法在地球科学应用的书，可以作为数值方法在大气、水文、地貌、地址和环境科学等方面的应用的入门教科书。" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 有限差分法 | 数值地球" />
  
  <meta name="twitter:description" content="这是一本有关数值方法在地球科学应用的书，可以作为数值方法在大气、水文、地貌、地址和环境科学等方面的应用的入门教科书。" />
  <meta name="twitter:image" content="https://shud.xyz/Book_NME/image/Cover.jpg" />

<meta name="author" content="舒乐乐，孟宪红" />


<meta name="date" content="2023-06-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="nm.html"/>
<link rel="next" href="fem.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数值地球</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>绪论</a></li>
<li class="chapter" data-level="1" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>1</b> 建模方法</a>
<ul>
<li class="chapter" data-level="1.1" data-path="modeling.html"><a href="modeling.html#建模基本思路"><i class="fa fa-check"></i><b>1.1</b> 建模基本思路</a>
<ul>
<li class="chapter" data-level="" data-path="modeling.html"><a href="modeling.html#案例自由落体运动"><i class="fa fa-check"></i>案例：自由落体运动</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="nm.html"><a href="nm.html"><i class="fa fa-check"></i><b>2</b> 数值方法基础</a>
<ul>
<li class="chapter" data-level="2.1" data-path="nm.html"><a href="nm.html#隐式与显式求解法"><i class="fa fa-check"></i><b>2.1</b> 隐式与显式求解法</a></li>
<li class="chapter" data-level="2.2" data-path="nm.html"><a href="nm.html#数值迭代方法"><i class="fa fa-check"></i><b>2.2</b> 数值迭代方法</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="nm.html"><a href="nm.html#牛顿迭代newton-iteration"><i class="fa fa-check"></i><b>2.2.1</b> 牛顿迭代(Newton Iteration)</a></li>
<li class="chapter" data-level="2.2.2" data-path="nm.html"><a href="nm.html#欧拉方法euler-method"><i class="fa fa-check"></i><b>2.2.2</b> 欧拉方法(Euler Method)</a></li>
<li class="chapter" data-level="2.2.3" data-path="nm.html"><a href="nm.html#龙格-库塔方法runge-kutta-method"><i class="fa fa-check"></i><b>2.2.3</b> 龙格-库塔方法(Runge-Kutta Method)</a></li>
<li class="chapter" data-level="2.2.4" data-path="nm.html"><a href="nm.html#皮卡法picard-method"><i class="fa fa-check"></i><b>2.2.4</b> 皮卡法(Picard Method)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="nm.html"><a href="nm.html#有限元-有限差分-有限体积"><i class="fa fa-check"></i><b>2.3</b> 有限元, 有限差分 ,有限体积</a></li>
<li class="chapter" data-level="2.4" data-path="nm.html"><a href="nm.html#cfl条件约束"><i class="fa fa-check"></i><b>2.4</b> CFL条件约束</a></li>
<li class="chapter" data-level="2.5" data-path="nm.html"><a href="nm.html#时空离散化"><i class="fa fa-check"></i><b>2.5</b> 时空离散化</a></li>
<li class="chapter" data-level="2.6" data-path="nm.html"><a href="nm.html#初始条件"><i class="fa fa-check"></i><b>2.6</b> 初始条件</a></li>
<li class="chapter" data-level="2.7" data-path="nm.html"><a href="nm.html#边界条件"><i class="fa fa-check"></i><b>2.7</b> 边界条件</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fdm.html"><a href="fdm.html"><i class="fa fa-check"></i><b>3</b> 有限差分法</a>
<ul>
<li class="chapter" data-level="3.1" data-path="fdm.html"><a href="fdm.html#泰勒展开式taylor-series"><i class="fa fa-check"></i><b>3.1</b> 泰勒展开式(Taylor Series)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="fdm.html"><a href="fdm.html#一阶导数"><i class="fa fa-check"></i><b>3.1.1</b> 一阶导数</a></li>
<li class="chapter" data-level="3.1.2" data-path="fdm.html"><a href="fdm.html#二阶导数"><i class="fa fa-check"></i><b>3.1.2</b> 二阶导数</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="fdm.html"><a href="fdm.html#构建数值方法"><i class="fa fa-check"></i><b>3.2</b> 构建数值方法</a></li>
<li class="chapter" data-level="3.3" data-path="fdm.html"><a href="fdm.html#显式求解法"><i class="fa fa-check"></i><b>3.3</b> 显式求解法</a></li>
<li class="chapter" data-level="3.4" data-path="fdm.html"><a href="fdm.html#隐式求解法"><i class="fa fa-check"></i><b>3.4</b> 隐式求解法</a></li>
<li class="chapter" data-level="3.5" data-path="fdm.html"><a href="fdm.html#编程求解"><i class="fa fa-check"></i><b>3.5</b> 编程求解</a></li>
<li class="chapter" data-level="3.6" data-path="fdm.html"><a href="fdm.html#显式与隐式求解法对比"><i class="fa fa-check"></i><b>3.6</b> 显式与隐式求解法对比</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="fdm.html"><a href="fdm.html#cfl条件"><i class="fa fa-check"></i><b>3.6.1</b> CFL条件</a></li>
<li class="chapter" data-level="3.6.2" data-path="fdm.html"><a href="fdm.html#计算效率"><i class="fa fa-check"></i><b>3.6.2</b> 计算效率</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="fdm.html"><a href="fdm.html#二维有限差分"><i class="fa fa-check"></i><b>3.7</b> 二维有限差分</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="fdm.html"><a href="fdm.html#编程求解-1"><i class="fa fa-check"></i><b>3.7.1</b> 编程求解</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fem.html"><a href="fem.html"><i class="fa fa-check"></i><b>4</b> 有限元法</a></li>
<li class="chapter" data-level="5" data-path="fvm.html"><a href="fvm.html"><i class="fa fa-check"></i><b>5</b> 有限体积法</a></li>
<li class="chapter" data-level="6" data-path="app.html"><a href="app.html"><i class="fa fa-check"></i><b>6</b> 应用案例</a>
<ul>
<li class="chapter" data-level="6.1" data-path="app.html"><a href="app.html#热传播问题heat-transfer"><i class="fa fa-check"></i><b>6.1</b> 热传播问题(Heat Transfer)</a></li>
<li class="chapter" data-level="6.2" data-path="app.html"><a href="app.html#大气混沌系统chaos-system-in-atmosphere"><i class="fa fa-check"></i><b>6.2</b> 大气混沌系统（Chaos System in Atmosphere）</a></li>
<li class="chapter" data-level="6.3" data-path="app.html"><a href="app.html#承压地下水confined-aquifer"><i class="fa fa-check"></i><b>6.3</b> 承压地下水（Confined Aquifer）</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="app.html"><a href="app.html#控制方程"><i class="fa fa-check"></i><b>6.3.1</b> 控制方程</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="app.html"><a href="app.html#湖面湍流lake-turbulence"><i class="fa fa-check"></i><b>6.4</b> 湖面湍流（Lake Turbulence）</a></li>
<li class="chapter" data-level="6.5" data-path="app.html"><a href="app.html#溶质运移solute-transport"><i class="fa fa-check"></i><b>6.5</b> 溶质运移（Solute Transport）</a></li>
<li class="chapter" data-level="6.6" data-path="app.html"><a href="app.html#地貌侵蚀landscape-evolution"><i class="fa fa-check"></i><b>6.6</b> 地貌侵蚀（Landscape Evolution）</a></li>
<li class="chapter" data-level="6.7" data-path="app.html"><a href="app.html#熔岩入侵lava-invasion"><i class="fa fa-check"></i><b>6.7</b> 熔岩入侵（Lava Invasion）</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://shud.xyz/Book_NME" target="blank">本书网址</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数值地球</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fdm" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> 有限差分法<a href="fdm.html#fdm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="泰勒展开式taylor-series" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> 泰勒展开式(Taylor Series)<a href="fdm.html#泰勒展开式taylor-series" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在数学中，泰勒级数（英語：Taylor series）用无限项连加式——级数来表示一个函数，这些相加的项由函数在某一点的导数求得。泰勒级数是以于1715年发表了泰勒公式的英國数学家布魯克·泰勒（Sir Brook Taylor）来命名的。</p>
<p>泰勒展开式的基本形式：</p>
<p><span class="math display" id="eq:taylor0">\[\begin{equation}
f(x) = \sum_{k=0}^n  \frac{f^{(n)}(0) }{n!}( x) ^{n}
\tag{3.1}
\end{equation}\]</span></p>
<div class="figure">
<img src="image/ch1/Taylor/Taylor.001.jpeg" alt="" />
<p class="caption">Taylor Series</p>
</div>
<p>根据泰勒展开式，通过<span class="math inline">\(f(x)\)</span>和其任意阶的导数，可以获得任意<span class="math inline">\(\Delta x\)</span>值下的函数值<span class="math inline">\(f(x + \Delta x)\)</span> ，即:</p>
<p><span class="math display" id="eq:dt">\[\begin{equation}
f(x+\Delta x) = f(x) + \frac{f&#39;(x)}{1!} \Delta x + \frac{f^{&#39;&#39;}(x)}{2!} \Delta x^2 + \frac{f^{&#39;&#39;&#39;}(x)}{3!} \Delta x^3+\dotsb + \frac{f^{(n)}(x) }{n!}( \Delta x) ^{n}
\tag{3.2}
\end{equation}\]</span></p>
<p>或者在<span class="math inline">\(-\Delta x\)</span>位置，可写为：</p>
<p><span class="math display" id="eq:dt-">\[\begin{equation}
f(x-\Delta x) = f(x) - \frac{f&#39;(x)}{1!} \Delta x + \frac{f^{&#39;&#39;}(x)}{2!} \Delta x^2 - \frac{f^{&#39;&#39;&#39;}(x)}{3!} \Delta x^3+\dotsb + \frac{f^{(n)}(x) }{n!}(- \Delta x) ^{n}
\tag{3.3}
\end{equation}\]</span></p>
<p>以上公式也可以写为：
<span class="math display" id="eq:udt">\[\begin{equation}
u_{i+1} = u_{i} + \frac{u^{&#39;}_{i}}{1!} \Delta x + \frac{u^{&#39;&#39;}_{i}}{2!} \Delta x^2 + \frac{u^{&#39;&#39;&#39;}_{i}}{3!} \Delta x^3+\dotsb + \frac{u^{(n)}_{i} }{n!}( \Delta x) ^{n}
\tag{3.4}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:udt-">\[\begin{equation}
u_{i-1} = u_{i} - \frac{u^{&#39;}_{i}}{1!} \Delta x + \frac{u^{&#39;&#39;}_{i}}{2!} \Delta x^2 - \frac{u^{&#39;&#39;&#39;}_{i}}{3!} \Delta x^3+\dotsb + \frac{u^{(n)}_{i} }{n!}(- \Delta x) ^{n}
\tag{3.5}
\end{equation}\]</span></p>
<p>在此，我们需要引入<strong>截断误差（truncation error）</strong>的概念，数学表达为<span class="math inline">\(O()\)</span>。 <span class="math inline">\(O(2)\)</span>和<span class="math inline">\(O(3)\)</span>分别表示为在泰勒展开式上的二阶和三阶导数上的误差。<strong>截取误差的阶数越高，误差越小</strong>。</p>
<p><span class="math display">\[O(1) = \frac{u^{&#39;&#39;}_{i}}{2!} \Delta x^2+\frac{u^{&#39;&#39;&#39;}_{i}}{3!} \Delta x^3+\frac{u^{(4)}_{i}}{4!} \Delta x^4+\dotsb + \frac{u^{(n)}_{i} }{n!}( \Delta x) ^{n}\]</span></p>
<p><span class="math display">\[O(2) = \frac{u^{&#39;&#39;&#39;}_{i}}{3!} \Delta x^3+\dotsb + \frac{u^{(n)}_{i} }{n!}( \Delta x) ^{n}\]</span>
<span class="math display">\[O(3) = \frac{u^{(4)}_{i}}{4!} \Delta x^4+\dotsb + \frac{u^{(n)}_{i} }{n!}( \Delta x) ^{n}\]</span></p>
<p><strong>何种情况下，泰勒展开式的截断误差为0？</strong></p>
<ul>
<li><span class="math inline">\(O(0) = 0\)</span> 时，意味着：<span class="math inline">\(f(x+\Delta x) = f(x)\)</span>。则该函数为<span class="math inline">\(f(x) = C\)</span>, <span class="math inline">\(C\)</span>为常数。
如图：</li>
</ul>
<p><img src="image/ch1/Taylor/Taylor.002.jpeg" /></p>
<ul>
<li><span class="math inline">\(O(1) = 0\)</span> 时，意味着：<span class="math inline">\(f(x+\Delta x) = f(x) + f^{&#39;}(x) \cdot \Delta x\)</span>。则该函数为<span class="math inline">\(f(x) = ax + b\)</span>。
如图：</li>
</ul>
<p><img src="image/ch1/Taylor/Taylor.003.jpeg" /></p>
<p><strong>如何依据泰勒级数，得到函数的一阶和二阶导数？</strong></p>
<div id="一阶导数" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> 一阶导数<a href="fdm.html#一阶导数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="向前估计-forward-approximation" class="section level4 hasAnchor" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> 向前估计 (Forward Approximation)<a href="fdm.html#向前估计-forward-approximation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>采纳一阶截断误差，我们可将公式<a href="fdm.html#eq:dt">(3.2)</a>写为：
<span class="math display">\[\begin{equation}
f(x+\Delta x) = f(x) + \frac{f&#39;(x)}{1!} \Delta x + O(1)
\end{equation}\]</span>
则：
<span class="math display" id="eq:d1f">\[\begin{equation}
f&#39;(x) = \frac {f(x+\Delta x) - f(x) } {\Delta x}
\tag{3.6}
\end{equation}\]</span>
或者
<span class="math display" id="eq:d1f">\[\begin{equation}
u&#39;_{i} = \frac {u_{i+1} - u_{i} } {\Delta x}
\tag{3.6}
\end{equation}\]</span></p>
<p><em>注：公式<a href="fdm.html#eq:d1f">(3.6)</a>隐含了<span class="math inline">\(O(1)\)</span>的误差。</em></p>
<div class="figure">
<img src="image/ch1/Taylor/Taylor.004.jpeg" alt="" />
<p class="caption">向前估计</p>
</div>
</div>
<div id="向后估计-backward-approximation" class="section level4 hasAnchor" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> 向后估计 (Backward Approximation)<a href="fdm.html#向后估计-backward-approximation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>采纳一阶截断误差，我们可将公式<a href="fdm.html#eq:dt-">(3.3)</a>写为：
<span class="math display">\[\begin{equation}
f(x-\Delta x) = f(x) - \frac{f&#39;(x)}{1!} \Delta x + O(1)
\end{equation}\]</span>
则：
<span class="math display" id="eq:d1b">\[\begin{equation}
f&#39;(x) = \frac {f(x) -f(x-\Delta x) } {\Delta x}
\tag{3.7}
\end{equation}\]</span>
或者
<span class="math display" id="eq:d1b">\[\begin{equation}
u&#39;_{i} = \frac { u_{i} - u_{i-1}} {\Delta x}
\tag{3.7}
\end{equation}\]</span></p>
<p><em>注：公式<a href="fdm.html#eq:d1b">(3.7)</a>隐含了<span class="math inline">\(O(1)\)</span>的误差。</em></p>
<div class="figure">
<img src="image/ch1/Taylor/Taylor.005.jpeg" alt="" />
<p class="caption">向后估计</p>
</div>
</div>
<div id="中心估计-central-approximation" class="section level4 hasAnchor" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> 中心估计 (Central Approximation)<a href="fdm.html#中心估计-central-approximation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>中心估计算法中，我们将从公式<a href="fdm.html#eq:dt">(3.2)</a>减去公式<a href="fdm.html#eq:dt-">(3.3)</a>，得到：
<span class="math display">\[
f(x+\Delta x)  - f(x-\Delta x) = 0 + 2 * \frac{f&#39;(x)}{1!} \Delta x + 0 + 2 * \frac{f^{&#39;&#39;&#39;}(x)}{3!} + ...
\]</span></p>
<p>截断误差由以上公式右边的第四项（三阶导数）开始，则该公式的截取误差为<span class="math inline">\(O(2)\)</span>，即二阶精度的截取误差，公式表达为：
<span class="math display">\[
f(x+\Delta x)  - f(x-\Delta x) = 0 + 2 * \frac{f&#39;(x)}{1!} \Delta x + 0 + O(2)
\]</span>
可得到二阶精度的一阶导数的中心估计：
<span class="math display" id="eq:d1c">\[\begin{equation}
f&#39;(x) = \frac {f(x+\Delta x) -f(x-\Delta x) } {2\Delta x}
\tag{3.8}
\end{equation}\]</span>
或者
<span class="math display" id="eq:d1c">\[\begin{equation}
u&#39;_{i} = \frac { u_{i+1} - u_{i-1}} {2\Delta x}
\tag{3.8}
\end{equation}\]</span></p>
<p>公式<a href="fdm.html#eq:d1c">(3.8)</a>隐含了<span class="math inline">\(O(2)\)</span>的误差，同时<a href="fdm.html#eq:d1f">(3.6)</a>和<a href="fdm.html#eq:d1b">(3.7)</a>都隐含了<span class="math inline">\(O(1)\)</span>的误差。</p>
<div class="figure">
<img src="image/ch1/Taylor/Taylor.006.jpeg" alt="" />
<p class="caption">中心估计</p>
</div>
</div>
</div>
<div id="二阶导数" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> 二阶导数<a href="fdm.html#二阶导数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>我们将公式 <a href="fdm.html#eq:dt">(3.2)</a>和<a href="fdm.html#eq:dt-">(3.3)</a>相加，可得到：</p>
<p><span class="math display" id="eq:d2">\[\begin{equation}
f(x+\Delta x) + f(x-\Delta x) = 2 \cdot f(x) + 0  + 2 \cdot \frac{f^{&#39;&#39;}(x)}{2!} \Delta x^2 + 0 + 2 \cdot \frac{f^{(4)}(x)} {4!} \Delta x^4 + \dotsb
\tag{3.9}
\end{equation}\]</span></p>
<p>公式<a href="fdm.html#eq:d2">(3.9)</a>来自公式 <a href="fdm.html#eq:dt">(3.2)</a>和<a href="fdm.html#eq:dt-">(3.3)</a>的相加，三阶导数项在相加过程中为零，因此我们截取其三阶截取误差，则公式<a href="fdm.html#eq:d2">(3.9)</a>可写为：
<span class="math display" id="eq:d2oo">\[\begin{equation}
f(x+\Delta x) + f(x-\Delta x) = 2f(x) + f^{&#39;&#39;}(x) \Delta x^2 + O(3)
\tag{3.10}
\end{equation}\]</span></p>
<p>根据公式<a href="fdm.html#eq:d2oo">(3.10)</a>，我们可获得函数<span class="math inline">\(f(x)\)</span>在<span class="math inline">\(x\)</span>位置的二阶导数为：</p>
<p><span class="math display" id="eq:d2o">\[\begin{equation}
f^{&#39;&#39;}(x) = \frac { f(x+\Delta x) - 2f(x)  + f(x-\Delta x) } { \Delta x^2 } + O(3)
\tag{3.11}
\end{equation}\]</span></p>
<p>当移除其三阶截断误差<span class="math inline">\(O(3)\)</span>后，我们得到近似的二阶导数：</p>
<p><span class="math display" id="eq:d2o3">\[\begin{align}
f^{&#39;&#39;}(x) &amp; \approx \frac {1}{ \Delta x } \left( \frac{ f(x+\Delta x) - f(x) }{ \Delta x }  + \frac{ f(x) - f(x-\Delta x) } { \Delta x } \right) \\
    &amp; \approx \frac { f(x+\Delta x) - 2f(x)  + f(x-\Delta x) } { \Delta x^2 }
\tag{3.12}
\end{align}\]</span></p>
<p>将公式一般化，我们可写为以下形式：</p>
<p><span class="math display" id="eq:d2o3">\[\begin{align}
u^{&#39;&#39;}_{i} &amp;\approx \frac {1}{ \Delta x } \left( \frac{u_{i+1} - u_{i}}{\Delta x} - \frac{u_{i} - u_{i-1}}{\Delta x} \right) \\
&amp; \approx \frac { u_{i+1} - 2u_{i}  + u_{i-1}  } { \Delta x^2 } \\
\tag{3.12}
\end{align}\]</span></p>
<div class="figure">
<img src="image/ch1/Taylor/Taylor.007.jpeg" alt="" />
<p class="caption">二阶导数估计</p>
</div>
</div>
</div>
<div id="构建数值方法" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> 构建数值方法<a href="fdm.html#构建数值方法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="example">
<p><span id="exm:unnamed-chunk-5" class="example"><strong>Example 3.1  </strong></span>一根100<span class="math inline">\(cm\)</span>长的铁棍，初始温度25 <span class="math inline">\(^\circ C\)</span>，在其左右两边分别持续施加100<span class="math inline">\(^\circ C\)</span>和<span class="math inline">\(50 ^\circ C\)</span>的温度。
<strong>求解</strong>：任意时刻铁棍的温度分布。</p>
</div>
<p>参考信息：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Thermal_diffusivity">wiki:Thermal_diffusivity</a></li>
<li><a href="https://en.wikipedia.org/wiki/Heat_equation">wiki:Heat_equation</a></li>
</ul>
<ol style="list-style-type: decimal">
<li><p><strong>问题描述</strong></p>
<p>空间微分，如图。
<img src="image/FDM/FDM.001.jpeg" /></p></li>
<li><p><strong>物理定理</strong></p>
<p>能量守恒：<br />
能量变化 = 能量流入 - 能量流出
<span class="math display">\[ \Delta E = Q _{in} - Q _{out} \]</span></p></li>
<li><p><strong>控制方程</strong></p>
<p><span class="math display">\[ 通量 = \frac {量}{单位时间 \cdot 单位面积} \]</span></p>
<ul>
<li><span class="math inline">\(k\)</span> - 热传导率[<span class="math inline">\(W m^{-1} K ^{-1}\)</span>]。</li>
<li><span class="math inline">\(c\)</span> - 比热容(specific heat capacity)[<span class="math inline">\(J {kg}^{-1} K ^{-1}\)</span>]。</li>
<li><span class="math inline">\(\rho\)</span> - 密度[<span class="math inline">\({kg} m^{-3}\)</span>]。</li>
<li><span class="math inline">\(A\)</span> - 截面积[<span class="math inline">\(m^2\)</span>]。</li>
<li><span class="math inline">\(D\)</span> - 热力学扩散度（Thermal diffusivity）<span class="math inline">\(D = \frac{k}{\rho c}\)</span> [<span class="math inline">\(m^2 s^{-1}\)</span>]。</li>
</ul>
<p><span class="math display">\[ \rho * c * \Delta x * A * \Delta u = q_{in} * A * \Delta t - q_{out} * A * \Delta t\]</span>
两边同时除以<span class="math inline">\(\rho c \Delta x A\)</span>，得到
<span class="math display">\[\frac {\Delta u}{\Delta t} = \frac{1}{\rho c} \frac{q_{in} - q_{out}}{\Delta x}\]</span>
以上公式当<span class="math inline">\(\Delta x\)</span>趋近与0，<span class="math inline">\(\Delta t\)</span>趋近于0时，得到微分形式：
<span class="math display">\[\frac {\partial u}{\partial t} = \frac{1}{\rho c} \frac{\partial q} {\partial x}\]</span></p>
<p><span class="math display">\[q = k \frac{\partial u}{\partial x}\]</span>
则得到其控制方程：
<span class="math display">\[\begin{equation}
\begin{aligned}
\frac {\partial u}{\partial t} &amp;= \frac{1}{\rho c} \frac{\partial q} {\partial x} \\
  &amp;= \frac{1}{\rho c} \frac{k \frac{\partial u}{\partial x} } {\partial x} \\
  &amp;= D\frac{\partial } {\partial x} \left(\frac{\partial u}{\partial x}  \right)
\end{aligned}
\end{equation}\]</span></p>
<p>令<span class="math inline">\(D=\frac{k}{\rho c}\)</span>，单位[$ m s^{-2}$]，则最终控制方程写为</p>
<p><span class="math display" id="eq:heatge">\[\begin{equation}
\frac {\partial u}{\partial t} =D\frac{\partial ^2 u} {\partial x^2}
\tag{3.13}
\end{equation}\]</span></p></li>
<li><p><strong>时空离散化</strong></p>
<p>由一阶泰勒级数可知，控制方程<a href="fdm.html#eq:heatge">(3.13)</a>左边可写为：
<span class="math display">\[\frac {\partial u}{\partial t}  = D\frac{u^{t}_{i} - u^{t-1}_{i} }{\Delta t} + O(1)\]</span>
控制方程<a href="fdm.html#eq:heatge">(3.13)</a>左边可写为：
<span class="math display">\[\begin{equation}
\frac{\partial ^2 u} {\partial x^2} =\frac{u^{t-1}_{i+1} - 2u^{t-1}_{i} + u^{t-1}_{i-1} }{\Delta x} + O(3)
\end{equation}\]</span>
或者
<span class="math display">\[\begin{equation}
\frac{\partial ^2 u} {\partial x^2} =\frac{u^{t}_{i+1} - 2u^{t}_{i} + u^{t}_{i-1} }{\Delta x} + O(3)
\end{equation}\]</span></p>
<p>此时，方程左边在时间尺度上具有一阶截取误差<span class="math inline">\(O(1)\)</span>，方程右边在空间尺度上具有三阶截断误差<span class="math inline">\(O(3)\)</span>。省去误差项，离散化后控制方程写为：
<span class="math display" id="eq:heatTSex">\[\begin{equation}
\frac{u^{t}_{i} - u^{t-1}_{i} }{\Delta t} = D \frac{u^{t-1}_{i+1} - 2u^{t-1}_{i} + u^{t-1}_{i-1} }{\Delta x ^2}
\tag{3.14}
\end{equation}\]</span>
或者
<span class="math display" id="eq:heatTSim">\[\begin{equation}
\frac{u^{t}_{i} - u^{t-1}_{i} }{\Delta t} = D \frac{u^{t}_{i+1} - 2u^{t}_{i} + u^{t}_{i-1} }{\Delta x ^2}
\tag{3.15}
\end{equation}\]</span></p></li>
<li><p><strong>求解</strong></p></li>
</ol>
</div>
<div id="显式求解法" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> 显式求解法<a href="fdm.html#显式求解法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>显式求解法以公式<a href="fdm.html#eq:heatTSex">(3.14)</a>作为起点，该公式可变形为：
<span class="math display">\[
u^{t}_{i} - u^{t-1}_{i}  = \frac{D \Delta t}{{\Delta x}^2} \left(  u^{t-1}_{i+1} - 2u^{t-1}_{i} + u^{t-1}_{i-1}  \right)
\]</span>
令<span class="math inline">\(\alpha = \frac{D \Delta t}{\Delta x^2}\)</span>, <span class="math inline">\(\beta = 1 - 2\alpha\)</span>，整理以上公式可得：</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
u^{t}_{i} - u^{t-1}_{i}  &amp;= \alpha \left(  u^{t-1}_{i+1} - 2u^{t-1}_{i} + u^{t-1}_{i-1}  \right) \\
u^{t}_{i}  &amp;= \alpha  u^{t-1}_{i+1} + (1- 2\alpha) u^{t-1}_{i} + \alpha u^{t-1}_{i-1}  \\
u^{t}_{i}  &amp;= \alpha  u^{t-1}_{i+1} + \beta u^{t-1}_{i} + \alpha u^{t-1}_{i-1}
\end{aligned}
\end{equation}\]</span></p>
<p>将以上公式应用于离散点上，</p>
<table>
<colgroup>
<col width="42%" />
<col width="57%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">点号 <span class="math inline">\(i\)</span></th>
<th align="center">公式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">边界条件: <span class="math inline">\(u^{t}_{1} = U_{0}\)</span></td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center"><span class="math inline">\(u^{t}_{2} = \alpha u^{t-1}_{3} + \beta u^{t-1}_{2} + \alpha u^{t-1}_{1}\)</span></td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center"><span class="math inline">\(u^{t}_{3} = \alpha u^{t-1}_{4} + \beta u^{t-1}_{3} + \alpha u^{t-1}_{2}\)</span></td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center"><span class="math inline">\(u^{t}_{4} = \alpha u^{t-1}_{5} + \beta u^{t-1}_{4} + \alpha u^{t-1}_{3}\)</span></td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center"><span class="math inline">\(u^{t}_{5} = \alpha u^{t-1}_{6} + \beta u^{t-1}_{5} + \alpha u^{t-1}_{4}\)</span></td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr class="odd">
<td align="center">i-1</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">i</td>
<td align="center"><span class="math inline">\(u^{t}_{i} = \alpha u^{t-1}_{i+1} + \beta u^{t-1}_{i} + \alpha u^{t-1}_{i-1}\)</span></td>
</tr>
<tr class="odd">
<td align="center">i+1</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr class="odd">
<td align="center">n-2</td>
<td align="center"><span class="math inline">\(u^{t}_{n-2} = \alpha u^{t-1}_{n-1} + \beta u^{t-1}_{n-2} + \alpha u^{t-1}_{n-3}\)</span></td>
</tr>
<tr class="even">
<td align="center">n-1</td>
<td align="center"><span class="math inline">\(u^{t}_{n-1} = \alpha u^{t-1}_{n} + \beta u^{t-1}_{n-1} + \alpha u^{t-1}_{n-2}\)</span></td>
</tr>
<tr class="odd">
<td align="center">n</td>
<td align="center">边界条件: <span class="math inline">\(u^{t}_{n} = U_{L}\)</span></td>
</tr>
</tbody>
</table>
<p>由此我们得到<span class="math inline">\(n\)</span>个算式，可转换为矩阵形式：</p>
<p><span class="math display">\[\begin{equation}
\begin{bmatrix}
u_{1}^{t} \\ u_{2}^{t} \\ u_{3}^{t} \\ u_{4}^{t} \\
\dots \\ u_{i}^{t} \\  \dots \\ u_{n-3}^{t} \\
u_{n-2}^{t} \\ u_{n-1}^{t} \\  u_{n}^{t} \end{bmatrix}
=
\begin{bmatrix}
    {\color{red}1}     &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \alpha      &amp; ~\beta~ &amp; \alpha &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    0 &amp; \alpha      &amp; ~\beta~ ~&amp; \alpha &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0 &amp; 0    &amp; \dots  &amp; \alpha  &amp; ~\beta~&amp; \alpha &amp; \dots &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  \alpha~&amp;  ~\beta~ &amp;  \alpha  &amp; 0  \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   \alpha &amp; ~\beta~ &amp; \alpha   \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   0&amp;  0 &amp;{\color{red}1}   
\end{bmatrix}

\begin{bmatrix}
U_{0} \\ u_{2}^{t-1} \\ u_{3}^{t-1} \\ u_{4}^{t-1} \\
\dots \\ u_{i}^{t-1} \\ \dots \\
u_{n-3}^{t-1} \\ u_{n-2}^{t-1} \\ u_{n-1}^{t-1} \\ U_{L}
\end{bmatrix}
\end{equation}\]</span></p>
<p>更简洁的方式，可写为：</p>
<p><span class="math display">\[\begin{equation}
\begin{bmatrix}
u_{1} \\ u_{2} \\ u_{3} \\ u_{4} \\
\dots \\ u_{i} \\  \dots \\ u_{n-3} \\
u_{n-2} \\ u_{n-1} \\  u_{n} \end{bmatrix} ^{t}
=
\begin{bmatrix}
    {\color{red}1}     &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \alpha      &amp; ~\beta~ &amp; \alpha &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    0 &amp; \alpha      &amp; ~\beta~ ~&amp; \alpha &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0 &amp; 0    &amp; \dots  &amp; \alpha  &amp; ~\beta~&amp; \alpha &amp; \dots &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  \alpha~&amp;  ~\beta~ &amp;  \alpha  &amp; 0  \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   \alpha &amp; ~\beta~ &amp; \alpha   \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   0&amp;  0 &amp;{\color{red}1}   
\end{bmatrix}

\begin{bmatrix}
U_{0} \\ u_{2} \\ u_{3} \\ u_{4} \\
\dots \\ u_{i} \\ \dots \\
u_{n-3} \\ u_{n-2} \\ u_{n-1} \\ U_{L}
\end{bmatrix} ^{t-1}
\end{equation}\]</span></p>
<p>下一时刻(<span class="math inline">\(t\)</span>)的变量组成的向量<span class="math inline">\(x\)</span>由一个矩阵<span class="math inline">\([A]\)</span>乘以已知的前一时刻(<span class="math inline">\(t-1\)</span>)的向量<span class="math inline">\(b\)</span>获得，即：。
<span class="math display">\[
x = [A] * b
\]</span>
由已知变量的矩阵求解未知变量的方法，称为<strong>显式求解法</strong>。</p>
</div>
<div id="隐式求解法" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> 隐式求解法<a href="fdm.html#隐式求解法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>显式求解法以公式<a href="fdm.html#eq:heatTSim">(3.15)</a>作为起点，该公式可变形为：
<span class="math display">\[
u^{t}_{i} - u^{t-1}_{i}  = \frac{D \Delta t}{{\Delta x}^2} \left(  u^{t}_{i+1} - 2u^{t}_{i} + u^{t}_{i-1}  \right)
\]</span>
令<span class="math inline">\(\alpha = \frac{D \Delta t}{\Delta x^2}\)</span>, <span class="math inline">\(\beta = -1 - 2\alpha\)</span>，整理以上公式可得：</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
u^{t}_{i} - u^{t-1}_{i}  &amp;= \alpha \left(  u^{t}_{i+1} - 2u^{t}_{i} + u^{t}_{i-1}  \right) \\
-u^{t-1}_{i}  &amp;= \alpha  u^{t}_{i+1} + (-1- 2\alpha) u^{t}_{i} + \alpha u^{t}_{i-1}  \\
-u^{t-1}_{i}  &amp;= \alpha  u^{t}_{i+1} + \beta u^{t}_{i} + \alpha u^{t}_{i-1}
\end{aligned}
\end{equation}\]</span></p>
<p>将以上公式应用于离散点上，</p>
<table>
<colgroup>
<col width="42%" />
<col width="57%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">点号 <span class="math inline">\(i\)</span></th>
<th align="center">公式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">边界条件: <span class="math inline">\(u^{t-1}_{1} = U_{0}\)</span></td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{2} = \alpha u^{t}_{3} + \beta u^{t}_{2} + \alpha u^{t}_{1}\)</span></td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{3} = \alpha u^{t}_{4} + \beta u^{t}_{3} + \alpha u^{t}_{2}\)</span></td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{4} = \alpha u^{t}_{5} + \beta u^{t}_{4} + \alpha u^{t}_{3}\)</span></td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{5} = \alpha u^{t}_{6} + \beta u^{t}_{5} + \alpha u^{t}_{4}\)</span></td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr class="odd">
<td align="center">i-1</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">i</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{i} = \alpha u^{t}_{i+1} + \beta u^{t}_{i} + \alpha u^{t}_{i-1}\)</span></td>
</tr>
<tr class="odd">
<td align="center">i+1</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr class="odd">
<td align="center">n-2</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{n-2} = \alpha u^{t}_{n-1} + \beta u^{t}_{n-2} + \alpha u^{t}_{n-3}\)</span></td>
</tr>
<tr class="even">
<td align="center">n-1</td>
<td align="center"><span class="math inline">\(-u^{t-1}_{n-1} = \alpha u^{t}_{n} + \beta u^{t}_{n-1} + \alpha u^{t}_{n-2}\)</span></td>
</tr>
<tr class="odd">
<td align="center">n</td>
<td align="center">边界条件: <span class="math inline">\(u^{t-1}_{n} = U_{L}\)</span></td>
</tr>
</tbody>
</table>
<p>由此我们得到<span class="math inline">\(n\)</span>个算式，可转换为矩阵形式：</p>
<p><span class="math display">\[\begin{equation}
\begin{bmatrix}
    {\color{red}1}     &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \alpha      &amp; ~\beta~ &amp; \alpha &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    0 &amp; \alpha      &amp; ~\beta~ ~&amp; \alpha &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0 &amp; 0    &amp; \dots  &amp; \alpha  &amp; ~\beta~&amp; \alpha &amp; \dots &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  \alpha~&amp;  ~\beta~ &amp;  \alpha  &amp; 0  \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   \alpha &amp; ~\beta~ &amp; \alpha   \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   0&amp;  0 &amp;{\color{red}1}   
\end{bmatrix}
\begin{bmatrix}
U_{0} \\ u_{2}^{t} \\ u_{3}^{t} \\ u_{4}^{t} \\
\dots \\ u_{i}^{t} \\ \dots \\
u_{n-3}^{t} \\ u_{n-2}^{t} \\ u_{n-1}^{t} \\ U_{L}
\end{bmatrix}
= -
\begin{bmatrix}
u_{1}^{t-1} \\ u_{2}^{t-1} \\ u_{3}^{t-1} \\ u_{4}^{t-1} \\
\dots \\ u_{i}^{t-1} \\  \dots \\ u_{n-3}^{t-1} \\
u_{n-2}^{t-1} \\ u_{n-1}^{t-1} \\  u_{n}^{t-1}
\end{bmatrix}

\end{equation}\]</span></p>
<p>更简洁的方式，可写为：</p>
<p><span class="math display">\[\begin{equation}
\begin{bmatrix}
    {\color{red}1}     &amp; 0 &amp; 0 &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \alpha      &amp; ~\beta~ &amp; \alpha &amp; 0 &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    0 &amp; \alpha      &amp; ~\beta~ ~&amp; \alpha &amp; \dots &amp; 0  &amp; 0  &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0 &amp; 0    &amp; \dots  &amp; \alpha  &amp; ~\beta~&amp; \alpha &amp; \dots &amp; 0   &amp; 0\\
    \dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots &amp;\dots \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  \alpha~&amp;  ~\beta~ &amp;  \alpha  &amp; 0  \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   \alpha &amp; ~\beta~ &amp; \alpha   \\
    0   &amp; 0&amp; 0  &amp; 0  &amp;  \dots &amp;  0 &amp;   0&amp;  0 &amp;{\color{red}1}   
\end{bmatrix}

\begin{bmatrix}
U_{0} \\ u_{2} \\ u_{3} \\ u_{4} \\
\dots \\ u_{i} \\ \dots \\
u_{n-3} \\ u_{n-2} \\ u_{n-1} \\ U_{L}
\end{bmatrix} ^{t}
= -
\begin{bmatrix}
u_{1} \\ u_{2} \\ u_{3} \\ u_{4} \\
\dots \\ u_{i} \\  \dots \\ u_{n-3} \\
u_{n-2} \\ u_{n-1} \\  u_{n} \end{bmatrix} ^{t-1}
\end{equation}\]</span></p>
<p>一个矩阵<span class="math inline">\([A]\)</span>乘以下一时刻(<span class="math inline">\(t\)</span>)的变量组成的向量<span class="math inline">\(x\)</span>等于已知的前一时刻(<span class="math inline">\(t-1\)</span>)的向量<span class="math inline">\(b\)</span>，求解该方程则可得到<span class="math inline">\(x\)</span>的值，数学表达为：</p>
<p><span class="math display">\[[A] * x = b\]</span></p>
<p>通用的求解法为
<span class="math display">\[
x = [A]^{-1} * b
\]</span></p>
<p>通过已知变量、未知变量和矩阵组成的公式或函数来求解未知变量的过程，称为<strong>隐式求解法</strong>。</p>
</div>
<div id="编程求解" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> 编程求解<a href="fdm.html#编程求解" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>显式求解法</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="fdm.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Problem: 1D Heat Transfer</span></span>
<span id="cb8-2"><a href="fdm.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  governing Eqn: du/dt = k/r/c * (dd u / d x^2)</span></span>
<span id="cb8-3"><a href="fdm.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  wiki: https://en.wikipedia.org/wiki/Thermal_diffusivity</span></span>
<span id="cb8-4"><a href="fdm.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  wiki: https://en.wikipedia.org/wiki/Heat_equation</span></span>
<span id="cb8-5"><a href="fdm.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; BC U0 = 100, UL=50</span></span>
<span id="cb8-6"><a href="fdm.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; IC uic = 25 </span></span>
<span id="cb8-7"><a href="fdm.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  X = c(0, 1)</span></span>
<span id="cb8-8"><a href="fdm.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  D = 23 mm2/s = 2.3e-5 m^2/s</span></span>
<span id="cb8-9"><a href="fdm.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  DX = 0.01 m</span></span>
<span id="cb8-10"><a href="fdm.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  DT = 10 s</span></span>
<span id="cb8-11"><a href="fdm.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  Time = 0 to 1e6 s</span></span>
<span id="cb8-12"><a href="fdm.html#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="fdm.html#cb8-13" aria-hidden="true" tabindex="-1"></a>HT.explicit <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb8-14"><a href="fdm.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">U0=</span><span class="dv">100</span>, <span class="at">UL=</span><span class="dv">50</span>, <span class="at">uic =</span> <span class="dv">25</span>,</span>
<span id="cb8-15"><a href="fdm.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="dv">1</span>,</span>
<span id="cb8-16"><a href="fdm.html#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">DX=</span> <span class="fl">0.1</span>,</span>
<span id="cb8-17"><a href="fdm.html#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">DT =</span> <span class="dv">1</span>,</span>
<span id="cb8-18"><a href="fdm.html#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">DD =</span> <span class="fl">2.3e-5</span>,</span>
<span id="cb8-19"><a href="fdm.html#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tmax =</span> <span class="fl">1e5</span>,</span>
<span id="cb8-20"><a href="fdm.html#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">epsilon =</span> <span class="fl">1e-4</span>, <span class="at">bc2 =</span> <span class="cn">NULL</span>,  <span class="at">ignore.cfl =</span> <span class="cn">FALSE</span>, <span class="at">plot =</span> <span class="cn">TRUE</span></span>
<span id="cb8-21"><a href="fdm.html#cb8-21" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb8-22"><a href="fdm.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  T0 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb8-23"><a href="fdm.html#cb8-23" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">=</span> <span class="fu">seq</span>(T0, Tmax, DT)</span>
<span id="cb8-24"><a href="fdm.html#cb8-24" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> <span class="fu">length</span>(tt)</span>
<span id="cb8-25"><a href="fdm.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, X, DX)</span>
<span id="cb8-26"><a href="fdm.html#cb8-26" aria-hidden="true" tabindex="-1"></a>  NX <span class="ot">=</span> X <span class="sc">/</span> DX <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-27"><a href="fdm.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-28"><a href="fdm.html#cb8-28" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">=</span> DD  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb8-29"><a href="fdm.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="dv">1-2</span><span class="sc">*</span>alpha</span>
<span id="cb8-30"><a href="fdm.html#cb8-30" aria-hidden="true" tabindex="-1"></a>  CFL <span class="ot">=</span> DD  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb8-31"><a href="fdm.html#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(CFL)  </span>
<span id="cb8-32"><a href="fdm.html#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>ignore.cfl){</span>
<span id="cb8-33"><a href="fdm.html#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(CFL <span class="sc">&gt;=</span><span class="dv">1</span> ){</span>
<span id="cb8-34"><a href="fdm.html#cb8-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>()</span>
<span id="cb8-35"><a href="fdm.html#cb8-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-36"><a href="fdm.html#cb8-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-37"><a href="fdm.html#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb8-38"><a href="fdm.html#cb8-38" aria-hidden="true" tabindex="-1"></a>  x0 <span class="ot">=</span> <span class="fu">rep</span>(uic, NX)</span>
<span id="cb8-39"><a href="fdm.html#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb8-40"><a href="fdm.html#cb8-40" aria-hidden="true" tabindex="-1"></a>  ylim <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">min</span>(x0), <span class="fu">max</span>(U0, UL))</span>
<span id="cb8-41"><a href="fdm.html#cb8-41" aria-hidden="true" tabindex="-1"></a>  xlim<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>, X)</span>
<span id="cb8-42"><a href="fdm.html#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(plot){</span>
<span id="cb8-43"><a href="fdm.html#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(xx, x0, <span class="at">type=</span><span class="st">&#39;b&#39;</span>, <span class="at">col=</span><span class="dv">2</span>,  <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">ylim=</span>ylim, <span class="at">xlim=</span>xlim, <span class="at">xlab=</span>xlab, <span class="at">ylab=</span>ylab)</span>
<span id="cb8-44"><a href="fdm.html#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grid</span>()</span>
<span id="cb8-45"><a href="fdm.html#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">0</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="fu">min</span>(x0), U0), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&#39;b&#39;</span>)</span>
<span id="cb8-46"><a href="fdm.html#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> X, <span class="at">y=</span><span class="fu">c</span>(<span class="fu">min</span>(x0), UL), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&#39;b&#39;</span>)</span>
<span id="cb8-47"><a href="fdm.html#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="at">x=</span>X<span class="sc">/</span><span class="dv">2</span> , <span class="at">y =</span> uic <span class="sc">+</span> <span class="fu">diff</span>(ylim)<span class="sc">*</span>.<span class="dv">051</span>, <span class="st">&#39;Initial condition&#39;</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb8-48"><a href="fdm.html#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="at">x=</span>X <span class="sc">*</span> <span class="fl">0.05</span> , <span class="at">y =</span> U0, <span class="st">&#39;BC 1&#39;</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb8-49"><a href="fdm.html#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="at">x=</span>X <span class="sc">*</span> <span class="fl">0.95</span> , <span class="at">y =</span> UL, <span class="st">&#39;BC 2&#39;</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb8-50"><a href="fdm.html#cb8-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-51"><a href="fdm.html#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb8-52"><a href="fdm.html#cb8-52" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> NX, <span class="at">ncol =</span> NX)</span>
<span id="cb8-53"><a href="fdm.html#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NX){</span>
<span id="cb8-54"><a href="fdm.html#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NX){</span>
<span id="cb8-55"><a href="fdm.html#cb8-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">==</span>j){</span>
<span id="cb8-56"><a href="fdm.html#cb8-56" aria-hidden="true" tabindex="-1"></a>        mat[i, j] <span class="ot">=</span> beta</span>
<span id="cb8-57"><a href="fdm.html#cb8-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-58"><a href="fdm.html#cb8-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">+</span><span class="dv">1</span> <span class="sc">==</span> j <span class="sc">|</span> i<span class="dv">-1</span> <span class="sc">==</span> j ){</span>
<span id="cb8-59"><a href="fdm.html#cb8-59" aria-hidden="true" tabindex="-1"></a>        mat[i, j] <span class="ot">=</span> alpha</span>
<span id="cb8-60"><a href="fdm.html#cb8-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-61"><a href="fdm.html#cb8-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-62"><a href="fdm.html#cb8-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-63"><a href="fdm.html#cb8-63" aria-hidden="true" tabindex="-1"></a>  mat[<span class="dv">1</span>,]<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, NX<span class="dv">-1</span>))</span>
<span id="cb8-64"><a href="fdm.html#cb8-64" aria-hidden="true" tabindex="-1"></a>  mat[NX,]<span class="ot">=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, NX<span class="dv">-1</span>), <span class="dv">1</span>)</span>
<span id="cb8-65"><a href="fdm.html#cb8-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-66"><a href="fdm.html#cb8-66" aria-hidden="true" tabindex="-1"></a>  xm <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>NX, <span class="at">ncol=</span>NT)</span>
<span id="cb8-67"><a href="fdm.html#cb8-67" aria-hidden="true" tabindex="-1"></a>  vs <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, NX))</span>
<span id="cb8-68"><a href="fdm.html#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vs[NX/2] = ss</span></span>
<span id="cb8-69"><a href="fdm.html#cb8-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-70"><a href="fdm.html#cb8-70" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span>bx <span class="ot">=</span> <span class="fu">cbind</span>(x0)</span>
<span id="cb8-71"><a href="fdm.html#cb8-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NT){</span>
<span id="cb8-72"><a href="fdm.html#cb8-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb8-73"><a href="fdm.html#cb8-73" aria-hidden="true" tabindex="-1"></a>      bx <span class="ot">=</span> mat <span class="sc">%*%</span> b <span class="sc">+</span> vs <span class="sc">*</span> DT</span>
<span id="cb8-74"><a href="fdm.html#cb8-74" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.nan</span>(bx))) { <span class="cf">break</span> }</span>
<span id="cb8-75"><a href="fdm.html#cb8-75" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(b<span class="sc">-</span>bx)) <span class="sc">&lt;</span> epsilon) { <span class="cf">break</span> }</span>
<span id="cb8-76"><a href="fdm.html#cb8-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-77"><a href="fdm.html#cb8-77" aria-hidden="true" tabindex="-1"></a>    bx[<span class="dv">1</span>] <span class="ot">=</span> U0</span>
<span id="cb8-78"><a href="fdm.html#cb8-78" aria-hidden="true" tabindex="-1"></a>    bx[NX] <span class="ot">=</span> UL</span>
<span id="cb8-79"><a href="fdm.html#cb8-79" aria-hidden="true" tabindex="-1"></a>    xm[, i]<span class="ot">=</span>bx</span>
<span id="cb8-80"><a href="fdm.html#cb8-80" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> bx</span>
<span id="cb8-81"><a href="fdm.html#cb8-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-82"><a href="fdm.html#cb8-82" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> i</span>
<span id="cb8-83"><a href="fdm.html#cb8-83" aria-hidden="true" tabindex="-1"></a>  xm<span class="ot">=</span>xm[, <span class="dv">1</span><span class="sc">:</span>NT]</span>
<span id="cb8-84"><a href="fdm.html#cb8-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># message(&#39;CFL value = &#39;, CFL)  </span></span>
<span id="cb8-85"><a href="fdm.html#cb8-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># message(&#39;Total Timesteps (dt * nt)= &#39;, DT, &#39; * &#39;, NT)</span></span>
<span id="cb8-86"><a href="fdm.html#cb8-86" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">=</span> xm; yy[<span class="fu">abs</span>(yy)<span class="sc">&gt;</span><span class="fl">1e20</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-87"><a href="fdm.html#cb8-87" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;x&#39;</span> <span class="ot">=</span> xx, </span>
<span id="cb8-88"><a href="fdm.html#cb8-88" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;time&#39;</span> <span class="ot">=</span> tt,</span>
<span id="cb8-89"><a href="fdm.html#cb8-89" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;u&#39;</span> <span class="ot">=</span> xm,</span>
<span id="cb8-90"><a href="fdm.html#cb8-90" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;CFL&#39;</span> <span class="ot">=</span> CFL,</span>
<span id="cb8-91"><a href="fdm.html#cb8-91" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;DT&#39;</span> <span class="ot">=</span> DT,</span>
<span id="cb8-92"><a href="fdm.html#cb8-92" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;NT&#39;</span> <span class="ot">=</span> NT,</span>
<span id="cb8-93"><a href="fdm.html#cb8-93" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;xlim&#39;</span> <span class="ot">=</span> xlim,</span>
<span id="cb8-94"><a href="fdm.html#cb8-94" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;ylim&#39;</span> <span class="ot">=</span> ylim)</span>
<span id="cb8-95"><a href="fdm.html#cb8-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb8-96"><a href="fdm.html#cb8-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-97"><a href="fdm.html#cb8-97" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">nout =</span> <span class="dv">20</span>){</span>
<span id="cb8-98"><a href="fdm.html#cb8-98" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> x<span class="sc">$</span>NT</span>
<span id="cb8-99"><a href="fdm.html#cb8-99" aria-hidden="true" tabindex="-1"></a>  id<span class="ot">=</span><span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log10</span>(x<span class="sc">$</span>NT), <span class="at">length.out =</span> nout)</span>
<span id="cb8-100"><a href="fdm.html#cb8-100" aria-hidden="true" tabindex="-1"></a>  col<span class="ot">=</span>colorspace<span class="sc">::</span><span class="fu">diverge_hcl</span>(<span class="at">n=</span><span class="fu">length</span>(id)); lty<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb8-101"><a href="fdm.html#cb8-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matplot</span>(<span class="at">x=</span>x<span class="sc">$</span>x, <span class="at">y=</span>x<span class="sc">$</span>u[, id], <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">ylim=</span>x<span class="sc">$</span>ylim, <span class="at">xlim=</span>x<span class="sc">$</span>xlim, </span>
<span id="cb8-102"><a href="fdm.html#cb8-102" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab=</span>xlab, <span class="at">ylab=</span>ylab, <span class="at">col=</span>col, <span class="at">lty=</span>lty)</span>
<span id="cb8-103"><a href="fdm.html#cb8-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="fu">paste0</span>(<span class="st">&#39;T=&#39;</span>, x<span class="sc">$</span>time[id]<span class="sc">+</span><span class="dv">1</span>), <span class="at">col=</span>col, <span class="at">lty=</span>lty, <span class="at">bg=</span><span class="st">&#39;transparent&#39;</span>)</span>
<span id="cb8-104"><a href="fdm.html#cb8-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&#39;CFL =&#39;</span>, x<span class="sc">$</span>CFL ), <span class="at">side=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb8-105"><a href="fdm.html#cb8-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-106"><a href="fdm.html#cb8-106" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb8-107"><a href="fdm.html#cb8-107" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> x<span class="sc">$</span>NT</span>
<span id="cb8-108"><a href="fdm.html#cb8-108" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>); nid<span class="ot">=</span><span class="fu">length</span>(id)</span>
<span id="cb8-109"><a href="fdm.html#cb8-109" aria-hidden="true" tabindex="-1"></a>  lty<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span>nid; col<span class="ot">=</span>lty</span>
<span id="cb8-110"><a href="fdm.html#cb8-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matplot</span>(<span class="fu">t</span>(x<span class="sc">$</span>u[id, ]), <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">xlab=</span>xlab, <span class="at">ylab=</span>ylab, <span class="at">col=</span>col, <span class="at">lty=</span>lty); <span class="fu">grid</span>()</span>
<span id="cb8-111"><a href="fdm.html#cb8-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>,<span class="at">col=</span>col, <span class="at">lty=</span>lty, <span class="fu">paste</span>(<span class="st">&#39;Node&#39;</span>, id))</span>
<span id="cb8-112"><a href="fdm.html#cb8-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>隐式求解法</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="fdm.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Problem: 1D Heat Transfer</span></span>
<span id="cb9-2"><a href="fdm.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  governing Eqn: du/dt = k/r/c * (dd u / d x^2)</span></span>
<span id="cb9-3"><a href="fdm.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  wiki: https://en.wikipedia.org/wiki/Thermal_diffusivity</span></span>
<span id="cb9-4"><a href="fdm.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  wiki: https://en.wikipedia.org/wiki/Heat_equation</span></span>
<span id="cb9-5"><a href="fdm.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; BC U0 = 100, UL=50</span></span>
<span id="cb9-6"><a href="fdm.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; IC uic = 25 </span></span>
<span id="cb9-7"><a href="fdm.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  X = c(0, 1)</span></span>
<span id="cb9-8"><a href="fdm.html#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  D = 23 mm2/s = 2.3e-5 m^2/s</span></span>
<span id="cb9-9"><a href="fdm.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  DX = 0.01 m</span></span>
<span id="cb9-10"><a href="fdm.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  DT = 10 s</span></span>
<span id="cb9-11"><a href="fdm.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  Time = 0 to 1e6 s</span></span>
<span id="cb9-12"><a href="fdm.html#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="fdm.html#cb9-13" aria-hidden="true" tabindex="-1"></a>HT.implicit <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-14"><a href="fdm.html#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">U0=</span><span class="dv">100</span>, <span class="at">UL=</span><span class="dv">50</span>, <span class="at">uic =</span> <span class="dv">25</span>,</span>
<span id="cb9-15"><a href="fdm.html#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="dv">1</span>,</span>
<span id="cb9-16"><a href="fdm.html#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">DX=</span> <span class="fl">0.1</span>,</span>
<span id="cb9-17"><a href="fdm.html#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">DT =</span> <span class="dv">1</span>,</span>
<span id="cb9-18"><a href="fdm.html#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">DD =</span> <span class="fl">2.3e-5</span>,</span>
<span id="cb9-19"><a href="fdm.html#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tmax =</span> <span class="fl">1e5</span>,</span>
<span id="cb9-20"><a href="fdm.html#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">epsilon =</span> <span class="fl">1e-4</span>, <span class="at">bc2 =</span> <span class="cn">NULL</span>,  <span class="at">ignore.cfl =</span> <span class="cn">FALSE</span>, <span class="at">plot =</span> <span class="cn">TRUE</span></span>
<span id="cb9-21"><a href="fdm.html#cb9-21" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb9-22"><a href="fdm.html#cb9-22" aria-hidden="true" tabindex="-1"></a>  T0 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb9-23"><a href="fdm.html#cb9-23" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">=</span> <span class="fu">seq</span>(T0, Tmax, DT)</span>
<span id="cb9-24"><a href="fdm.html#cb9-24" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> <span class="fu">length</span>(tt)</span>
<span id="cb9-25"><a href="fdm.html#cb9-25" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, X, DX)</span>
<span id="cb9-26"><a href="fdm.html#cb9-26" aria-hidden="true" tabindex="-1"></a>  NX <span class="ot">=</span> X <span class="sc">/</span> DX <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-27"><a href="fdm.html#cb9-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-28"><a href="fdm.html#cb9-28" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">=</span> <span class="sc">-</span>DD  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb9-29"><a href="fdm.html#cb9-29" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> DD  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb9-30"><a href="fdm.html#cb9-30" aria-hidden="true" tabindex="-1"></a>  CFL <span class="ot">=</span> DD  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb9-31"><a href="fdm.html#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(CFL)  </span>
<span id="cb9-32"><a href="fdm.html#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>ignore.cfl){</span>
<span id="cb9-33"><a href="fdm.html#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(CFL <span class="sc">&gt;=</span><span class="dv">1</span> ){</span>
<span id="cb9-34"><a href="fdm.html#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>()</span>
<span id="cb9-35"><a href="fdm.html#cb9-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-36"><a href="fdm.html#cb9-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-37"><a href="fdm.html#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb9-38"><a href="fdm.html#cb9-38" aria-hidden="true" tabindex="-1"></a>  x0 <span class="ot">=</span> <span class="fu">rep</span>(uic, NX)</span>
<span id="cb9-39"><a href="fdm.html#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb9-40"><a href="fdm.html#cb9-40" aria-hidden="true" tabindex="-1"></a>  ylim <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">min</span>(x0), <span class="fu">max</span>(U0, UL))</span>
<span id="cb9-41"><a href="fdm.html#cb9-41" aria-hidden="true" tabindex="-1"></a>  xlim<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>, X)</span>
<span id="cb9-42"><a href="fdm.html#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(plot){</span>
<span id="cb9-43"><a href="fdm.html#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(xx, x0, <span class="at">type=</span><span class="st">&#39;b&#39;</span>, <span class="at">col=</span><span class="dv">2</span>,  <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">ylim=</span>ylim, <span class="at">xlim=</span>xlim, <span class="at">xlab=</span>xlab, <span class="at">ylab=</span>ylab)</span>
<span id="cb9-44"><a href="fdm.html#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grid</span>()</span>
<span id="cb9-45"><a href="fdm.html#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">0</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="fu">min</span>(x0), U0), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&#39;b&#39;</span>)</span>
<span id="cb9-46"><a href="fdm.html#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> X, <span class="at">y=</span><span class="fu">c</span>(<span class="fu">min</span>(x0), UL), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&#39;b&#39;</span>)</span>
<span id="cb9-47"><a href="fdm.html#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="at">x=</span>X<span class="sc">/</span><span class="dv">2</span> , <span class="at">y =</span> uic <span class="sc">+</span> <span class="fu">diff</span>(ylim)<span class="sc">*</span>.<span class="dv">051</span>, <span class="st">&#39;Initial condition&#39;</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb9-48"><a href="fdm.html#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="at">x=</span>X <span class="sc">*</span> <span class="fl">0.05</span> , <span class="at">y =</span> U0, <span class="st">&#39;BC 1&#39;</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb9-49"><a href="fdm.html#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="at">x=</span>X <span class="sc">*</span> <span class="fl">0.95</span> , <span class="at">y =</span> UL, <span class="st">&#39;BC 2&#39;</span>, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb9-50"><a href="fdm.html#cb9-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-51"><a href="fdm.html#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb9-52"><a href="fdm.html#cb9-52" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> NX, <span class="at">ncol =</span> NX)</span>
<span id="cb9-53"><a href="fdm.html#cb9-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NX){</span>
<span id="cb9-54"><a href="fdm.html#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NX){</span>
<span id="cb9-55"><a href="fdm.html#cb9-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">==</span>j){</span>
<span id="cb9-56"><a href="fdm.html#cb9-56" aria-hidden="true" tabindex="-1"></a>        mat[i, j] <span class="ot">=</span> beta</span>
<span id="cb9-57"><a href="fdm.html#cb9-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-58"><a href="fdm.html#cb9-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">+</span><span class="dv">1</span> <span class="sc">==</span> j <span class="sc">|</span> i<span class="dv">-1</span> <span class="sc">==</span> j ){</span>
<span id="cb9-59"><a href="fdm.html#cb9-59" aria-hidden="true" tabindex="-1"></a>        mat[i, j] <span class="ot">=</span> alpha</span>
<span id="cb9-60"><a href="fdm.html#cb9-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-61"><a href="fdm.html#cb9-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-62"><a href="fdm.html#cb9-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-63"><a href="fdm.html#cb9-63" aria-hidden="true" tabindex="-1"></a>  mat[<span class="dv">1</span>,]<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, NX<span class="dv">-1</span>))</span>
<span id="cb9-64"><a href="fdm.html#cb9-64" aria-hidden="true" tabindex="-1"></a>  mat[NX,]<span class="ot">=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, NX<span class="dv">-1</span>), <span class="dv">1</span>)</span>
<span id="cb9-65"><a href="fdm.html#cb9-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-66"><a href="fdm.html#cb9-66" aria-hidden="true" tabindex="-1"></a>  xm <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>NX, <span class="at">ncol=</span>NT)</span>
<span id="cb9-67"><a href="fdm.html#cb9-67" aria-hidden="true" tabindex="-1"></a>  vs <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, NX))</span>
<span id="cb9-68"><a href="fdm.html#cb9-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vs[NX/2] = ss</span></span>
<span id="cb9-69"><a href="fdm.html#cb9-69" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span>bx<span class="ot">=</span><span class="fu">cbind</span>(x0)</span>
<span id="cb9-70"><a href="fdm.html#cb9-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NT){</span>
<span id="cb9-71"><a href="fdm.html#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb9-72"><a href="fdm.html#cb9-72" aria-hidden="true" tabindex="-1"></a>      bx <span class="ot">=</span> <span class="fu">solve</span>(mat, b)</span>
<span id="cb9-73"><a href="fdm.html#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.nan</span>(bx))) { <span class="cf">break</span> }</span>
<span id="cb9-74"><a href="fdm.html#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(b<span class="sc">-</span>bx)) <span class="sc">&lt;</span> epsilon) { <span class="cf">break</span> }</span>
<span id="cb9-75"><a href="fdm.html#cb9-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-76"><a href="fdm.html#cb9-76" aria-hidden="true" tabindex="-1"></a>    bx[<span class="dv">1</span>] <span class="ot">=</span> U0</span>
<span id="cb9-77"><a href="fdm.html#cb9-77" aria-hidden="true" tabindex="-1"></a>    bx[NX] <span class="ot">=</span> UL</span>
<span id="cb9-78"><a href="fdm.html#cb9-78" aria-hidden="true" tabindex="-1"></a>    xm[, i]<span class="ot">=</span>bx</span>
<span id="cb9-79"><a href="fdm.html#cb9-79" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> bx</span>
<span id="cb9-80"><a href="fdm.html#cb9-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-81"><a href="fdm.html#cb9-81" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> i</span>
<span id="cb9-82"><a href="fdm.html#cb9-82" aria-hidden="true" tabindex="-1"></a>  xm<span class="ot">=</span>xm[, <span class="dv">1</span><span class="sc">:</span>NT]</span>
<span id="cb9-83"><a href="fdm.html#cb9-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># message(&#39;CFL value = &#39;, CFL)  </span></span>
<span id="cb9-84"><a href="fdm.html#cb9-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># message(&#39;Total Timesteps (dt * nt)= &#39;, DT, &#39; * &#39;, NT)</span></span>
<span id="cb9-85"><a href="fdm.html#cb9-85" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">=</span> xm; yy[<span class="fu">abs</span>(yy)<span class="sc">&gt;</span><span class="fl">1e20</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb9-86"><a href="fdm.html#cb9-86" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;x&#39;</span> <span class="ot">=</span> xx, </span>
<span id="cb9-87"><a href="fdm.html#cb9-87" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;time&#39;</span> <span class="ot">=</span> tt,</span>
<span id="cb9-88"><a href="fdm.html#cb9-88" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;u&#39;</span> <span class="ot">=</span> xm,</span>
<span id="cb9-89"><a href="fdm.html#cb9-89" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;CFL&#39;</span> <span class="ot">=</span> CFL,</span>
<span id="cb9-90"><a href="fdm.html#cb9-90" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;DT&#39;</span> <span class="ot">=</span> DT,</span>
<span id="cb9-91"><a href="fdm.html#cb9-91" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;NT&#39;</span> <span class="ot">=</span> NT,</span>
<span id="cb9-92"><a href="fdm.html#cb9-92" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;xlim&#39;</span> <span class="ot">=</span> xlim,</span>
<span id="cb9-93"><a href="fdm.html#cb9-93" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;ylim&#39;</span> <span class="ot">=</span> ylim)</span>
<span id="cb9-94"><a href="fdm.html#cb9-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb9-95"><a href="fdm.html#cb9-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-96"><a href="fdm.html#cb9-96" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">nout =</span> <span class="dv">20</span>){</span>
<span id="cb9-97"><a href="fdm.html#cb9-97" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> x<span class="sc">$</span>NT</span>
<span id="cb9-98"><a href="fdm.html#cb9-98" aria-hidden="true" tabindex="-1"></a>  id<span class="ot">=</span><span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log10</span>(x<span class="sc">$</span>NT), <span class="at">length.out =</span> nout)</span>
<span id="cb9-99"><a href="fdm.html#cb9-99" aria-hidden="true" tabindex="-1"></a>  col<span class="ot">=</span>colorspace<span class="sc">::</span><span class="fu">diverge_hcl</span>(<span class="at">n=</span><span class="fu">length</span>(id)); lty<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb9-100"><a href="fdm.html#cb9-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matplot</span>(<span class="at">x=</span>x<span class="sc">$</span>x, <span class="at">y=</span>x<span class="sc">$</span>u[, id], <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">ylim=</span>x<span class="sc">$</span>ylim, <span class="at">xlim=</span>x<span class="sc">$</span>xlim, </span>
<span id="cb9-101"><a href="fdm.html#cb9-101" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab=</span>xlab, <span class="at">ylab=</span>ylab, <span class="at">col=</span>col, <span class="at">lty=</span>lty)</span>
<span id="cb9-102"><a href="fdm.html#cb9-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="fu">paste0</span>(<span class="st">&#39;T=&#39;</span>, x<span class="sc">$</span>time[id]<span class="sc">+</span><span class="dv">1</span>), <span class="at">col=</span>col, <span class="at">lty=</span>lty, <span class="at">bg=</span><span class="st">&#39;transparent&#39;</span>)</span>
<span id="cb9-103"><a href="fdm.html#cb9-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&#39;CFL =&#39;</span>, x<span class="sc">$</span>CFL ), <span class="at">side=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb9-104"><a href="fdm.html#cb9-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-105"><a href="fdm.html#cb9-105" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb9-106"><a href="fdm.html#cb9-106" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> x<span class="sc">$</span>NT</span>
<span id="cb9-107"><a href="fdm.html#cb9-107" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>); nid<span class="ot">=</span><span class="fu">length</span>(id)</span>
<span id="cb9-108"><a href="fdm.html#cb9-108" aria-hidden="true" tabindex="-1"></a>  lty<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span>nid; col<span class="ot">=</span>lty</span>
<span id="cb9-109"><a href="fdm.html#cb9-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matplot</span>(<span class="fu">t</span>(x<span class="sc">$</span>u[id, ]), <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">xlab=</span>xlab, <span class="at">ylab=</span>ylab, <span class="at">col=</span>col, <span class="at">lty=</span>lty); <span class="fu">grid</span>()</span>
<span id="cb9-110"><a href="fdm.html#cb9-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>,<span class="at">col=</span>col, <span class="at">lty=</span>lty, <span class="fu">paste</span>(<span class="st">&#39;Node&#39;</span>, id))</span>
<span id="cb9-111"><a href="fdm.html#cb9-111" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="显式与隐式求解法对比" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> 显式与隐式求解法对比<a href="fdm.html#显式与隐式求解法对比" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="cfl条件" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> CFL条件<a href="fdm.html#cfl条件" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="fdm.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_HeatTransferIm.R&quot;</span>)</span>
<span id="cb10-2"><a href="fdm.html#cb10-2" aria-hidden="true" tabindex="-1"></a>xlab <span class="ot">=</span><span class="st">&#39;Distance (m)&#39;</span></span>
<span id="cb10-3"><a href="fdm.html#cb10-3" aria-hidden="true" tabindex="-1"></a>ylab <span class="ot">=</span> <span class="st">&#39;Temperature (C)&#39;</span></span>
<span id="cb10-4"><a href="fdm.html#cb10-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">HT.implicit</span>(<span class="at">DX=</span> <span class="fl">0.05</span>, <span class="at">DT =</span> <span class="dv">1000</span>, <span class="at">U0=</span><span class="dv">100</span>, <span class="at">UL=</span><span class="dv">50</span>, <span class="at">uic =</span> <span class="dv">25</span>, <span class="at">ignore.cfl=</span><span class="cn">TRUE</span>, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 9.2</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="fdm.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot1</span>(x, <span class="at">nout=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="计算效率" class="section level3 hasAnchor" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> 计算效率<a href="fdm.html#计算效率" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="fdm.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_HeatTransferIm.R&quot;</span>)</span>
<span id="cb13-2"><a href="fdm.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_HeatTransferEx.R&quot;</span>)</span>
<span id="cb13-3"><a href="fdm.html#cb13-3" aria-hidden="true" tabindex="-1"></a>Tmax <span class="ot">=</span> <span class="fl">1e4</span></span>
<span id="cb13-4"><a href="fdm.html#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="fdm.html#cb13-5" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb13-6"><a href="fdm.html#cb13-6" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">HT.explicit</span>(<span class="at">DX=</span> <span class="fl">0.025</span>, <span class="at">DT =</span> <span class="dv">5</span>, <span class="at">U0=</span><span class="dv">100</span>, <span class="at">UL=</span><span class="dv">50</span>, <span class="at">uic =</span> <span class="dv">25</span>, <span class="at">X =</span> <span class="dv">1</span>, <span class="at">ignore.cfl=</span><span class="cn">FALSE</span>, <span class="at">plot=</span><span class="cn">FALSE</span>, <span class="at">Tmax=</span>Tmax)</span></code></pre></div>
<pre><code>## [1] 0.184</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="fdm.html#cb15-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb15-2"><a href="fdm.html#cb15-2" aria-hidden="true" tabindex="-1"></a>tu.ex <span class="ot">=</span> t1 <span class="sc">-</span> t0</span>
<span id="cb15-3"><a href="fdm.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="fdm.html#cb15-4" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb15-5"><a href="fdm.html#cb15-5" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">HT.implicit</span>(<span class="at">DX=</span> <span class="fl">0.025</span>, <span class="at">DT =</span> <span class="dv">5</span>, <span class="at">U0=</span><span class="dv">100</span>, <span class="at">UL=</span><span class="dv">50</span>, <span class="at">uic =</span> <span class="dv">25</span>, <span class="at">X =</span> <span class="dv">1</span>, <span class="at">ignore.cfl=</span><span class="cn">FALSE</span>, <span class="at">plot=</span><span class="cn">FALSE</span>, <span class="at">Tmax=</span>Tmax)</span></code></pre></div>
<pre><code>## [1] 0.184</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="fdm.html#cb17-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb17-2"><a href="fdm.html#cb17-2" aria-hidden="true" tabindex="-1"></a>tu.im <span class="ot">=</span> t1 <span class="sc">-</span> t0</span>
<span id="cb17-3"><a href="fdm.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="fdm.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&#39;Time for implicit =&#39;</span>, tu.im)</span></code></pre></div>
<pre><code>## Time for implicit =0.183983087539673</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="fdm.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&#39;Time for explicit =&#39;</span>, tu.ex)</span></code></pre></div>
<pre><code>## Time for explicit =0.115255117416382</code></pre>
</div>
</div>
<div id="二维有限差分" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> 二维有限差分<a href="fdm.html#二维有限差分" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="image/FDM/FDM.002.jpeg" /></p>
<div class="example">
<p><span id="exm:unnamed-chunk-10" class="example"><strong>Example 3.2  </strong></span><span class="math display">\[
s  \frac{dh}{dt} = k_{x} B * \frac{d^2 h}{d x^2} + k_{y} B * \frac{d^2 h}{d y^2} + s_s
\]</span></p>
</div>
<p>令<span class="math inline">\(D_x = \frac{k_x B}{s}\)</span>和<span class="math inline">\(D_y = \frac{k_y B}{s}\)</span>。</p>
<p>公式推导：</p>
<p>右边：
<span class="math display">\[\frac{\partial u}{\partial t} = \frac{u^{t+1}_{i, j} - u^{t}_{i, j} }{ \Delta t}\]</span></p>
<p>左边：</p>
<p><span class="math display">\[D_x\frac{\partial ^2 u}{\partial x^2} + D_y\frac{\partial ^2 u}{\partial y^2}= D_x\frac{u^{t}_{i+1, j} - 2 u^{t}_{i, j} + u^{t}_{i-1, j} }{ {\Delta x }^2} + D_y\frac{u^{t}_{i, j+1} - 2 u^{t}_{i, j} + u^{t}_{i, j-1} }{ {\Delta y }^2}\]</span></p>
<p>控制方程离散化后得到：
<span class="math display">\[
\frac{u^{t+1}_{i, j} - u^{t}_{i, j} }{ \Delta t} = D_x\frac{u^{t}_{i+1, j} - 2 u^{t}_{i, j} + u^{t}_{i-1, j} }{ {\Delta x }^2} + D_y\frac{u^{t}_{i, j+1} - 2 u^{t}_{i, j} + u^{t}_{i, j-1} }{ {\Delta y }^2}
\]</span></p>
<p><span class="math display">\[u^{t+1}_{i, j} - u^{t}_{i, j}= \frac{D_x \Delta t}{ {\Delta x }^2} (u^{t}_{i+1, j} - 2 u^{t}_{i, j} + u^{t}_{i-1, j} ) +
\frac{D_x \Delta t}{ {\Delta y }^2} (u^{t}_{i, j+1} - 2 u^{t}_{i, j} + u^{t}_{i, j-1})\]</span></p>
<p>令<span class="math inline">\(\alpha = \frac{D_x \Delta t}{ {\Delta x }^2}\)</span>, <span class="math inline">\(\beta = \frac{D_x \Delta t}{ {\Delta y }^2}\)</span>, <span class="math inline">\(\gamma = 1-2\frac{D_x \Delta t}{ {\Delta x }^2} - 2\frac{D_x \Delta t}{ {\Delta y }^2}\)</span>，公式变为：</p>
<p><span class="math display">\[
u^{t+1}_{i, j} = \alpha u^{t}_{i+1, j} + \beta u^{t}_{i, j+1} +  \gamma u^{t}_{i, j}  + \beta u^{t}_{i, j-1} + \alpha u^{t}_{i-1, j}
\]</span></p>
<div class="figure">
<img src="image/FDM/FDM.003.jpeg" alt="" />
<p class="caption">二维离散化格点</p>
</div>
<p>假设<span class="math inline">\(x\)</span>和<span class="math inline">\(y\)</span>方向总长为<span class="math inline">\(L_x\)</span>和<span class="math inline">\(L_y\)</span>，沿两个方向的离散点数为<span class="math inline">\(N_x =L_x / \Delta x\)</span>, <span class="math inline">\(N_y =L_y / \Delta y\)</span>, <span class="math inline">\(N = N_x * N_y\)</span>。
矩阵形式可表达为：
<span class="math display">\[ x = A * b \]</span></p>
<p><span class="math display">\[x = \begin{bmatrix}
\begin{bmatrix} u_{1,1} \\  \dots \\ u_{1, N_y} \end{bmatrix} \\
\begin{bmatrix} u_{2,1}   \\\dots \\  u_{2, N_y} \end{bmatrix} \\
\dots \\ u_{i,j} \\  \dots \\
\begin{bmatrix} u_{Nx, 1} \\ \dots\\  u_{N_x, N_y} \end{bmatrix}
\end{bmatrix} ^{t}\]</span></p>
<p><span class="math display">\[A =
\begin{bmatrix}
\begin{bmatrix}
{\color{red}1}   &amp; 0 &amp; 0  \\
    0      &amp; {\color{red}1} &amp; 0 \\
    0      &amp; 0 &amp; {\color{red}1}
\end{bmatrix} &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \begin{bmatrix}
{\color{red}1}   &amp; 0 &amp; 0  &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
   \beta &amp;  \dots &amp;  \alpha     &amp; {\gamma} &amp; \alpha &amp; \dots &amp; \beta \\
    0      &amp; 0 &amp; 0      &amp; 0 &amp;0      &amp; 0 &amp; {\color{red}1}
\end{bmatrix} &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \begin{bmatrix}
{\color{red}1}   &amp; 0 &amp; 0  &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
   \beta &amp;  \dots &amp;  \alpha     &amp; {\gamma} &amp; \alpha &amp; \dots &amp; \beta \\
    0      &amp; 0 &amp; 0      &amp; 0 &amp;0      &amp; 0 &amp; {\color{red}1}
\end{bmatrix} &amp; 0  \\
0 &amp; 0 &amp; 0 &amp; \begin{bmatrix}
{\color{red}1}   &amp; 0 &amp; 0  \\
   0     &amp; {\color{red}1} &amp; 0 \\
    0      &amp; 0 &amp; {\color{red}1}
\end{bmatrix} \\
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[b=
\begin{bmatrix}
[U_{1}]_{N_y*1} \\
\begin{bmatrix} U_2 \\ u_{2,1}   \\\dots \\  U_3 \end{bmatrix}_{N_y*1} \\
\begin{bmatrix} U_2 \\ u_{i,j}   \\\dots \\  U_3 \end{bmatrix}_{N_y*1} \\
[U_{4}]_{N_y*1}
\end{bmatrix} ^{t-1}\]</span></p>
<div id="编程求解-1" class="section level3 hasAnchor" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> 编程求解<a href="fdm.html#编程求解-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>显式求解</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="fdm.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Problem: 1D Confined Aquifer</span></span>
<span id="cb21-2"><a href="fdm.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  governing Eqn: du/dt = DDx * (dd u / d x^2) + DDy * (dd u / d y^2)</span></span>
<span id="cb21-3"><a href="fdm.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  </span></span>
<span id="cb21-4"><a href="fdm.html#cb21-4" aria-hidden="true" tabindex="-1"></a>diag.matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(id)), <span class="at">n =</span> <span class="dv">3</span>, <span class="at">def.val =</span> <span class="dv">0</span>){</span>
<span id="cb21-5"><a href="fdm.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">=</span> <span class="fu">matrix</span>(x, <span class="at">ncol=</span><span class="fu">length</span>(id), <span class="at">nrow=</span><span class="dv">1</span>)</span>
<span id="cb21-6"><a href="fdm.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="fu">matrix</span>(def.val, n, n)</span>
<span id="cb21-7"><a href="fdm.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  nid <span class="ot">=</span> <span class="fu">length</span>(id)</span>
<span id="cb21-8"><a href="fdm.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb21-9"><a href="fdm.html#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb21-10"><a href="fdm.html#cb21-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nid){</span>
<span id="cb21-11"><a href="fdm.html#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(i <span class="sc">+</span> id[k] <span class="sc">==</span> j){</span>
<span id="cb21-12"><a href="fdm.html#cb21-12" aria-hidden="true" tabindex="-1"></a>          mat[i,j] <span class="ot">=</span> val[k]</span>
<span id="cb21-13"><a href="fdm.html#cb21-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-14"><a href="fdm.html#cb21-14" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-15"><a href="fdm.html#cb21-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-16"><a href="fdm.html#cb21-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-17"><a href="fdm.html#cb21-17" aria-hidden="true" tabindex="-1"></a>  mat</span>
<span id="cb21-18"><a href="fdm.html#cb21-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-19"><a href="fdm.html#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="fdm.html#cb21-20" aria-hidden="true" tabindex="-1"></a>toBC <span class="ot">&lt;-</span> <span class="cf">function</span>(idl, x, val){</span>
<span id="cb21-21"><a href="fdm.html#cb21-21" aria-hidden="true" tabindex="-1"></a>  nbc <span class="ot">=</span> <span class="fu">length</span>(idl)</span>
<span id="cb21-22"><a href="fdm.html#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nbc){</span>
<span id="cb21-23"><a href="fdm.html#cb21-23" aria-hidden="true" tabindex="-1"></a>    x[idl[[i]]] <span class="ot">=</span> val[i]</span>
<span id="cb21-24"><a href="fdm.html#cb21-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-25"><a href="fdm.html#cb21-25" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb21-26"><a href="fdm.html#cb21-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-27"><a href="fdm.html#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="fdm.html#cb21-28" aria-hidden="true" tabindex="-1"></a>CA.Explicit <span class="ot">&lt;-</span> <span class="cf">function</span>(  <span class="at">bc1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb21-29"><a href="fdm.html#cb21-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bc2 =</span> <span class="cn">NULL</span>,</span>
<span id="cb21-30"><a href="fdm.html#cb21-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">uic =</span> <span class="dv">25</span>,</span>
<span id="cb21-31"><a href="fdm.html#cb21-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Lxy =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>),</span>
<span id="cb21-32"><a href="fdm.html#cb21-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dxy =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>),</span>
<span id="cb21-33"><a href="fdm.html#cb21-33" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DD =</span> <span class="fu">rep</span>(<span class="dv">23</span> ,<span class="dv">2</span>),</span>
<span id="cb21-34"><a href="fdm.html#cb21-34" aria-hidden="true" tabindex="-1"></a>                          <span class="at">epsilon =</span> <span class="fl">0.001</span>,</span>
<span id="cb21-35"><a href="fdm.html#cb21-35" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DT =</span> <span class="dv">25</span>,</span>
<span id="cb21-36"><a href="fdm.html#cb21-36" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tmax =</span> <span class="fl">1e5</span>,</span>
<span id="cb21-37"><a href="fdm.html#cb21-37" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ignore.cfl =</span> <span class="cn">FALSE</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>){</span>
<span id="cb21-38"><a href="fdm.html#cb21-38" aria-hidden="true" tabindex="-1"></a>  DX<span class="ot">=</span>Dxy[<span class="dv">1</span>]; DY<span class="ot">=</span>Dxy[<span class="dv">2</span>];</span>
<span id="cb21-39"><a href="fdm.html#cb21-39" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, Tmax, DT); </span>
<span id="cb21-40"><a href="fdm.html#cb21-40" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> <span class="fu">length</span>(tt)</span>
<span id="cb21-41"><a href="fdm.html#cb21-41" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, Lxy[<span class="dv">1</span>], DX); NX <span class="ot">=</span> <span class="fu">length</span>(xx)</span>
<span id="cb21-42"><a href="fdm.html#cb21-42" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, Lxy[<span class="dv">2</span>], DY); NY <span class="ot">=</span> <span class="fu">length</span>(yy)</span>
<span id="cb21-43"><a href="fdm.html#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># NX = Lxy[1] / DX + 1;   NY = Lxy[2] / DY + 1</span></span>
<span id="cb21-44"><a href="fdm.html#cb21-44" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> NX <span class="sc">*</span> NY</span>
<span id="cb21-45"><a href="fdm.html#cb21-45" aria-hidden="true" tabindex="-1"></a>  CFL.x <span class="ot">=</span> alpha <span class="ot">=</span> DD[<span class="dv">1</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb21-46"><a href="fdm.html#cb21-46" aria-hidden="true" tabindex="-1"></a>  CFL.y <span class="ot">=</span> beta  <span class="ot">=</span> DD[<span class="dv">2</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DY <span class="sc">*</span> DY)</span>
<span id="cb21-47"><a href="fdm.html#cb21-47" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> alpha <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> beta</span>
<span id="cb21-48"><a href="fdm.html#cb21-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&#39;CFL value = (&#39;</span>, CFL.x, <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, CFL.y, <span class="st">&#39;)&#39;</span>)  </span>
<span id="cb21-49"><a href="fdm.html#cb21-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>ignore.cfl){</span>
<span id="cb21-50"><a href="fdm.html#cb21-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(CFL.x <span class="sc">&gt;=</span>.<span class="dv">5</span> <span class="sc">|</span> CFL.y <span class="sc">&gt;=</span>.<span class="dv">5</span>){</span>
<span id="cb21-51"><a href="fdm.html#cb21-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>()</span>
<span id="cb21-52"><a href="fdm.html#cb21-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-53"><a href="fdm.html#cb21-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-54"><a href="fdm.html#cb21-54" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="fu">diag.matrix</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="sc">-</span>NY, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, NY), <span class="at">n=</span>N,</span>
<span id="cb21-55"><a href="fdm.html#cb21-55" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x=</span><span class="fu">c</span>(alpha, beta, gamma, beta, alpha), <span class="at">def.val =</span> <span class="dv">0</span>)</span>
<span id="cb21-56"><a href="fdm.html#cb21-56" aria-hidden="true" tabindex="-1"></a>  dmat <span class="ot">=</span> <span class="fu">diag.matrix</span>(<span class="at">id=</span><span class="dv">0</span>, <span class="at">x=</span><span class="dv">1</span>, <span class="at">n=</span>N, <span class="at">def.val =</span> <span class="dv">0</span>)</span>
<span id="cb21-57"><a href="fdm.html#cb21-57" aria-hidden="true" tabindex="-1"></a>  idl <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span>NY,</span>
<span id="cb21-58"><a href="fdm.html#cb21-58" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span>NX <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>(NY),</span>
<span id="cb21-59"><a href="fdm.html#cb21-59" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span><span class="sc">:</span>NX) <span class="sc">*</span> NY,</span>
<span id="cb21-60"><a href="fdm.html#cb21-60" aria-hidden="true" tabindex="-1"></a>             (NX<span class="dv">-1</span>)<span class="sc">*</span>(NY)<span class="sc">+</span><span class="dv">1</span><span class="sc">:</span>NY) </span>
<span id="cb21-61"><a href="fdm.html#cb21-61" aria-hidden="true" tabindex="-1"></a>  nbc <span class="ot">=</span> <span class="fu">length</span>(idl)</span>
<span id="cb21-62"><a href="fdm.html#cb21-62" aria-hidden="true" tabindex="-1"></a>  id.bc <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(idl)))</span>
<span id="cb21-63"><a href="fdm.html#cb21-63" aria-hidden="true" tabindex="-1"></a>  mat[id.bc, ] <span class="ot">=</span> dmat[id.bc,]</span>
<span id="cb21-64"><a href="fdm.html#cb21-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-65"><a href="fdm.html#cb21-65" aria-hidden="true" tabindex="-1"></a>  arr <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(NY,NX,NT))</span>
<span id="cb21-66"><a href="fdm.html#cb21-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># xm = matrix(NA, nrow=N, ncol=NT)</span></span>
<span id="cb21-67"><a href="fdm.html#cb21-67" aria-hidden="true" tabindex="-1"></a>  vs <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, N))</span>
<span id="cb21-68"><a href="fdm.html#cb21-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bc2=list(id=10, x=0.01)</span></span>
<span id="cb21-69"><a href="fdm.html#cb21-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vs[bc2$id] = bc2$x</span></span>
<span id="cb21-70"><a href="fdm.html#cb21-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-71"><a href="fdm.html#cb21-71" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span>bx<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">rep</span>(uic, N))</span>
<span id="cb21-72"><a href="fdm.html#cb21-72" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">=</span> <span class="fu">toBC</span>(<span class="at">idl =</span> idl, <span class="at">x=</span>b, <span class="at">val=</span>bc1)</span>
<span id="cb21-73"><a href="fdm.html#cb21-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-74"><a href="fdm.html#cb21-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NT){</span>
<span id="cb21-75"><a href="fdm.html#cb21-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb21-76"><a href="fdm.html#cb21-76" aria-hidden="true" tabindex="-1"></a>      bx <span class="ot">=</span> mat <span class="sc">%*%</span> b <span class="sc">+</span> vs <span class="sc">*</span> DT</span>
<span id="cb21-77"><a href="fdm.html#cb21-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.nan</span>(bx))) { <span class="cf">break</span> }</span>
<span id="cb21-78"><a href="fdm.html#cb21-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(b<span class="sc">-</span>bx)) <span class="sc">&lt;</span> epsilon) { <span class="cf">break</span> }</span>
<span id="cb21-79"><a href="fdm.html#cb21-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-80"><a href="fdm.html#cb21-80" aria-hidden="true" tabindex="-1"></a>    bx <span class="ot">=</span> <span class="fu">toBC</span>(<span class="at">idl =</span> idl, <span class="at">x=</span>bx, <span class="at">val=</span>bc1)</span>
<span id="cb21-81"><a href="fdm.html#cb21-81" aria-hidden="true" tabindex="-1"></a>    arr[, , i] <span class="ot">=</span> <span class="fu">matrix</span>(bx, <span class="at">nrow =</span> NY, <span class="at">ncol =</span> NX)</span>
<span id="cb21-82"><a href="fdm.html#cb21-82" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> bx</span>
<span id="cb21-83"><a href="fdm.html#cb21-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-84"><a href="fdm.html#cb21-84" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> i</span>
<span id="cb21-85"><a href="fdm.html#cb21-85" aria-hidden="true" tabindex="-1"></a>  arr<span class="ot">=</span>arr[,, <span class="dv">1</span><span class="sc">:</span>NT]</span>
<span id="cb21-86"><a href="fdm.html#cb21-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># message(&#39;Total Timesteps (dt * nt)= &#39;, DT, &#39; * &#39;, NT)</span></span>
<span id="cb21-87"><a href="fdm.html#cb21-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yy = arr; yy[abs(yy)&gt;1e20] = NA</span></span>
<span id="cb21-88"><a href="fdm.html#cb21-88" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;x&#39;</span> <span class="ot">=</span> xx,</span>
<span id="cb21-89"><a href="fdm.html#cb21-89" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;y&#39;</span> <span class="ot">=</span> yy,</span>
<span id="cb21-90"><a href="fdm.html#cb21-90" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;z&#39;</span> <span class="ot">=</span> arr,</span>
<span id="cb21-91"><a href="fdm.html#cb21-91" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;time&#39;</span> <span class="ot">=</span> tt,</span>
<span id="cb21-92"><a href="fdm.html#cb21-92" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;CFL&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(CFL.x, CFL.y),</span>
<span id="cb21-93"><a href="fdm.html#cb21-93" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;DT&#39;</span> <span class="ot">=</span> DT,</span>
<span id="cb21-94"><a href="fdm.html#cb21-94" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;NT&#39;</span> <span class="ot">=</span> NT</span>
<span id="cb21-95"><a href="fdm.html#cb21-95" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-96"><a href="fdm.html#cb21-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb21-97"><a href="fdm.html#cb21-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-98"><a href="fdm.html#cb21-98" aria-hidden="true" tabindex="-1"></a>plot<span class="fl">.3</span>d <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">nr=</span><span class="dv">3</span>, <span class="at">nc=</span><span class="dv">4</span>, <span class="at">clim=</span><span class="cn">NULL</span>){</span>
<span id="cb21-99"><a href="fdm.html#cb21-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(nr, nc), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb21-100"><a href="fdm.html#cb21-100" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">=</span> <span class="fu">round</span>(<span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log10</span>(x<span class="sc">$</span>NT), <span class="at">length.out =</span> nc<span class="sc">*</span>nr))</span>
<span id="cb21-101"><a href="fdm.html#cb21-101" aria-hidden="true" tabindex="-1"></a>  z<span class="ot">=</span>x<span class="sc">$</span>z; </span>
<span id="cb21-102"><a href="fdm.html#cb21-102" aria-hidden="true" tabindex="-1"></a>  z[ <span class="fu">is.infinite</span>(<span class="fu">abs</span>(z)) ] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb21-103"><a href="fdm.html#cb21-103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(clim)){</span>
<span id="cb21-104"><a href="fdm.html#cb21-104" aria-hidden="true" tabindex="-1"></a>    clim <span class="ot">=</span> <span class="fu">range</span>(z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-105"><a href="fdm.html#cb21-105" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-106"><a href="fdm.html#cb21-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> idx ){</span>
<span id="cb21-107"><a href="fdm.html#cb21-107" aria-hidden="true" tabindex="-1"></a>    plot3D<span class="sc">::</span><span class="fu">persp3D</span>(<span class="at">z=</span>z[, , i], <span class="at">clim=</span>clim,</span>
<span id="cb21-108"><a href="fdm.html#cb21-108" aria-hidden="true" tabindex="-1"></a>            <span class="at">colvar=</span>z[, , i])</span>
<span id="cb21-109"><a href="fdm.html#cb21-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">&#39;T =&#39;</span>, x<span class="sc">$</span>DT <span class="sc">*</span> i), <span class="at">side=</span> <span class="dv">3</span>, <span class="at">line=</span><span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb21-110"><a href="fdm.html#cb21-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-111"><a href="fdm.html#cb21-111" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="fdm.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot3D)</span>
<span id="cb22-2"><a href="fdm.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_ConfAq2DIm.R&quot;</span>)</span>
<span id="cb22-3"><a href="fdm.html#cb22-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">CA.Explicit</span>(<span class="at">bc1 =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">30</span>,<span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb22-4"><a href="fdm.html#cb22-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">uic =</span> <span class="dv">25</span>,</span>
<span id="cb22-5"><a href="fdm.html#cb22-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">Lxy =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>),</span>
<span id="cb22-6"><a href="fdm.html#cb22-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">Dxy =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>),</span>
<span id="cb22-7"><a href="fdm.html#cb22-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">DD =</span> <span class="fu">rep</span>(<span class="dv">23</span> ,<span class="dv">2</span>),</span>
<span id="cb22-8"><a href="fdm.html#cb22-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">epsilon =</span> <span class="fl">0.001</span>,</span>
<span id="cb22-9"><a href="fdm.html#cb22-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">DT =</span> <span class="dv">25</span>,</span>
<span id="cb22-10"><a href="fdm.html#cb22-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">Tmax =</span> <span class="dv">1000</span></span>
<span id="cb22-11"><a href="fdm.html#cb22-11" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## CFL value = (0.23    0.23)</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="fdm.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.3d</span>(x)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p><strong>隐式求解</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="fdm.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Problem: 1D Confined Aquifer</span></span>
<span id="cb25-2"><a href="fdm.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  governing Eqn: du/dt = DDx * (dd u / d x^2) + DDy * (dd u / d y^2)</span></span>
<span id="cb25-3"><a href="fdm.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  </span></span>
<span id="cb25-4"><a href="fdm.html#cb25-4" aria-hidden="true" tabindex="-1"></a>diag.matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(id)), <span class="at">n =</span> <span class="dv">3</span>, <span class="at">def.val =</span> <span class="dv">0</span>){</span>
<span id="cb25-5"><a href="fdm.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">=</span> <span class="fu">matrix</span>(x, <span class="at">ncol=</span><span class="fu">length</span>(id), <span class="at">nrow=</span><span class="dv">1</span>)</span>
<span id="cb25-6"><a href="fdm.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="fu">matrix</span>(def.val, n, n)</span>
<span id="cb25-7"><a href="fdm.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  nid <span class="ot">=</span> <span class="fu">length</span>(id)</span>
<span id="cb25-8"><a href="fdm.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb25-9"><a href="fdm.html#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb25-10"><a href="fdm.html#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nid){</span>
<span id="cb25-11"><a href="fdm.html#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(i <span class="sc">+</span> id[k] <span class="sc">==</span> j){</span>
<span id="cb25-12"><a href="fdm.html#cb25-12" aria-hidden="true" tabindex="-1"></a>          mat[i,j] <span class="ot">=</span> val[k]</span>
<span id="cb25-13"><a href="fdm.html#cb25-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-14"><a href="fdm.html#cb25-14" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb25-15"><a href="fdm.html#cb25-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-16"><a href="fdm.html#cb25-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-17"><a href="fdm.html#cb25-17" aria-hidden="true" tabindex="-1"></a>  mat</span>
<span id="cb25-18"><a href="fdm.html#cb25-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-19"><a href="fdm.html#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="fdm.html#cb25-20" aria-hidden="true" tabindex="-1"></a>toBC <span class="ot">&lt;-</span> <span class="cf">function</span>(idl, x, val){</span>
<span id="cb25-21"><a href="fdm.html#cb25-21" aria-hidden="true" tabindex="-1"></a>  nbc <span class="ot">=</span> <span class="fu">length</span>(idl)</span>
<span id="cb25-22"><a href="fdm.html#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nbc){</span>
<span id="cb25-23"><a href="fdm.html#cb25-23" aria-hidden="true" tabindex="-1"></a>    x[idl[[i]]] <span class="ot">=</span> val[i]</span>
<span id="cb25-24"><a href="fdm.html#cb25-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-25"><a href="fdm.html#cb25-25" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb25-26"><a href="fdm.html#cb25-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-27"><a href="fdm.html#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="fdm.html#cb25-28" aria-hidden="true" tabindex="-1"></a>CA.Implicit <span class="ot">&lt;-</span> <span class="cf">function</span>(  <span class="at">bc1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb25-29"><a href="fdm.html#cb25-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bc2 =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-30"><a href="fdm.html#cb25-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">uic =</span> <span class="dv">25</span>,</span>
<span id="cb25-31"><a href="fdm.html#cb25-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Lxy =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>),</span>
<span id="cb25-32"><a href="fdm.html#cb25-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Dxy =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>),</span>
<span id="cb25-33"><a href="fdm.html#cb25-33" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DD =</span> <span class="fu">rep</span>(<span class="dv">23</span> ,<span class="dv">2</span>),</span>
<span id="cb25-34"><a href="fdm.html#cb25-34" aria-hidden="true" tabindex="-1"></a>                          <span class="at">epsilon =</span> <span class="fl">0.001</span>,</span>
<span id="cb25-35"><a href="fdm.html#cb25-35" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DT =</span> <span class="dv">25</span>,</span>
<span id="cb25-36"><a href="fdm.html#cb25-36" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Tmax =</span> <span class="fl">1e5</span>,</span>
<span id="cb25-37"><a href="fdm.html#cb25-37" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ignore.cfl =</span> <span class="cn">FALSE</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>){</span>
<span id="cb25-38"><a href="fdm.html#cb25-38" aria-hidden="true" tabindex="-1"></a>  DX<span class="ot">=</span>Dxy[<span class="dv">1</span>]; DY<span class="ot">=</span>Dxy[<span class="dv">2</span>];</span>
<span id="cb25-39"><a href="fdm.html#cb25-39" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, Tmax, DT); </span>
<span id="cb25-40"><a href="fdm.html#cb25-40" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> <span class="fu">length</span>(tt)</span>
<span id="cb25-41"><a href="fdm.html#cb25-41" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, Lxy[<span class="dv">1</span>], DX); NX <span class="ot">=</span> <span class="fu">length</span>(xx)</span>
<span id="cb25-42"><a href="fdm.html#cb25-42" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, Lxy[<span class="dv">2</span>], DY); NY <span class="ot">=</span> <span class="fu">length</span>(yy)</span>
<span id="cb25-43"><a href="fdm.html#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># NX = Lxy[1] / DX + 1;   NY = Lxy[2] / DY + 1</span></span>
<span id="cb25-44"><a href="fdm.html#cb25-44" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> NX <span class="sc">*</span> NY</span>
<span id="cb25-45"><a href="fdm.html#cb25-45" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">=</span> <span class="sc">-</span>DD[<span class="dv">1</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb25-46"><a href="fdm.html#cb25-46" aria-hidden="true" tabindex="-1"></a>  beta  <span class="ot">=</span> <span class="sc">-</span>DD[<span class="dv">2</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DY <span class="sc">*</span> DY)</span>
<span id="cb25-47"><a href="fdm.html#cb25-47" aria-hidden="true" tabindex="-1"></a>  CFL.x <span class="ot">=</span>  DD[<span class="dv">1</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX)</span>
<span id="cb25-48"><a href="fdm.html#cb25-48" aria-hidden="true" tabindex="-1"></a>  CFL.y <span class="ot">=</span>  DD[<span class="dv">2</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DY <span class="sc">*</span> DY)</span>
<span id="cb25-49"><a href="fdm.html#cb25-49" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> DD[<span class="dv">1</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DX <span class="sc">*</span> DX) <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> DD[<span class="dv">2</span>]  <span class="sc">*</span> DT <span class="sc">/</span> (DY <span class="sc">*</span> DY)</span>
<span id="cb25-50"><a href="fdm.html#cb25-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&#39;CFL value = (&#39;</span>, CFL.x, <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, CFL.y, <span class="st">&#39;)&#39;</span>)  </span>
<span id="cb25-51"><a href="fdm.html#cb25-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>ignore.cfl){</span>
<span id="cb25-52"><a href="fdm.html#cb25-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(CFL.x <span class="sc">&gt;=</span>.<span class="dv">5</span> <span class="sc">|</span> CFL.y <span class="sc">&gt;=</span>.<span class="dv">5</span>){</span>
<span id="cb25-53"><a href="fdm.html#cb25-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>()</span>
<span id="cb25-54"><a href="fdm.html#cb25-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-55"><a href="fdm.html#cb25-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-56"><a href="fdm.html#cb25-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; =========================================</span></span>
<span id="cb25-57"><a href="fdm.html#cb25-57" aria-hidden="true" tabindex="-1"></a>  x0 <span class="ot">=</span> <span class="fu">rep</span>(uic, NX)</span>
<span id="cb25-58"><a href="fdm.html#cb25-58" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="fu">diag.matrix</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="sc">-</span>NY, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, NY), <span class="at">n=</span>N,</span>
<span id="cb25-59"><a href="fdm.html#cb25-59" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x=</span><span class="fu">c</span>(alpha, beta, gamma, beta, alpha), <span class="at">def.val =</span> <span class="dv">0</span>)</span>
<span id="cb25-60"><a href="fdm.html#cb25-60" aria-hidden="true" tabindex="-1"></a>  dmat <span class="ot">=</span> <span class="fu">diag.matrix</span>(<span class="at">id=</span><span class="dv">0</span>, <span class="at">x=</span><span class="dv">1</span>, <span class="at">n=</span>N, <span class="at">def.val =</span> <span class="dv">0</span>)</span>
<span id="cb25-61"><a href="fdm.html#cb25-61" aria-hidden="true" tabindex="-1"></a>  idl <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span>NY,</span>
<span id="cb25-62"><a href="fdm.html#cb25-62" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span>NX <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>(NY),</span>
<span id="cb25-63"><a href="fdm.html#cb25-63" aria-hidden="true" tabindex="-1"></a>             (<span class="dv">1</span><span class="sc">:</span>NX) <span class="sc">*</span> NY,</span>
<span id="cb25-64"><a href="fdm.html#cb25-64" aria-hidden="true" tabindex="-1"></a>             (NX<span class="dv">-1</span>)<span class="sc">*</span>(NY)<span class="sc">+</span><span class="dv">1</span><span class="sc">:</span>NY) </span>
<span id="cb25-65"><a href="fdm.html#cb25-65" aria-hidden="true" tabindex="-1"></a>  nbc <span class="ot">=</span> <span class="fu">length</span>(idl)</span>
<span id="cb25-66"><a href="fdm.html#cb25-66" aria-hidden="true" tabindex="-1"></a>  id.bc <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(idl)))</span>
<span id="cb25-67"><a href="fdm.html#cb25-67" aria-hidden="true" tabindex="-1"></a>  mat[id.bc, ] <span class="ot">=</span> dmat[id.bc,]</span>
<span id="cb25-68"><a href="fdm.html#cb25-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-69"><a href="fdm.html#cb25-69" aria-hidden="true" tabindex="-1"></a>  arr <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(NY,NX,NT))</span>
<span id="cb25-70"><a href="fdm.html#cb25-70" aria-hidden="true" tabindex="-1"></a>  vs <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, N))</span>
<span id="cb25-71"><a href="fdm.html#cb25-71" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span>bx<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">rep</span>(uic, N))</span>
<span id="cb25-72"><a href="fdm.html#cb25-72" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">=</span> <span class="fu">toBC</span>(<span class="at">idl =</span> idl, <span class="at">x=</span>b, <span class="at">val=</span>bc1)</span>
<span id="cb25-73"><a href="fdm.html#cb25-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-74"><a href="fdm.html#cb25-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NT){</span>
<span id="cb25-75"><a href="fdm.html#cb25-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb25-76"><a href="fdm.html#cb25-76" aria-hidden="true" tabindex="-1"></a>      bx <span class="ot">=</span> <span class="fu">solve</span>(mat, b <span class="sc">+</span> vs <span class="sc">*</span> DT)</span>
<span id="cb25-77"><a href="fdm.html#cb25-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.nan</span>(bx))) { <span class="cf">break</span> }</span>
<span id="cb25-78"><a href="fdm.html#cb25-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(b<span class="sc">-</span>bx)) <span class="sc">&lt;</span> epsilon) { <span class="cf">break</span> }</span>
<span id="cb25-79"><a href="fdm.html#cb25-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-80"><a href="fdm.html#cb25-80" aria-hidden="true" tabindex="-1"></a>    bx <span class="ot">=</span> <span class="fu">toBC</span>(<span class="at">idl =</span> idl, <span class="at">x=</span>bx, <span class="at">val=</span>bc1)</span>
<span id="cb25-81"><a href="fdm.html#cb25-81" aria-hidden="true" tabindex="-1"></a>    arr[, , i] <span class="ot">=</span> <span class="fu">matrix</span>(bx, <span class="at">nrow =</span> NY, <span class="at">ncol =</span> NX)</span>
<span id="cb25-82"><a href="fdm.html#cb25-82" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">=</span> bx</span>
<span id="cb25-83"><a href="fdm.html#cb25-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-84"><a href="fdm.html#cb25-84" aria-hidden="true" tabindex="-1"></a>  NT <span class="ot">=</span> i</span>
<span id="cb25-85"><a href="fdm.html#cb25-85" aria-hidden="true" tabindex="-1"></a>  arr<span class="ot">=</span>arr[,, <span class="dv">1</span><span class="sc">:</span>NT]</span>
<span id="cb25-86"><a href="fdm.html#cb25-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># message(&#39;Total Timesteps (dt * nt)= &#39;, DT, &#39; * &#39;, NT)</span></span>
<span id="cb25-87"><a href="fdm.html#cb25-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yy = arr; yy[abs(yy)&gt;1e20] = NA</span></span>
<span id="cb25-88"><a href="fdm.html#cb25-88" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;x&#39;</span> <span class="ot">=</span> xx,</span>
<span id="cb25-89"><a href="fdm.html#cb25-89" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;y&#39;</span> <span class="ot">=</span> yy,</span>
<span id="cb25-90"><a href="fdm.html#cb25-90" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;z&#39;</span> <span class="ot">=</span> arr,</span>
<span id="cb25-91"><a href="fdm.html#cb25-91" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;time&#39;</span> <span class="ot">=</span> tt,</span>
<span id="cb25-92"><a href="fdm.html#cb25-92" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;CFL&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(CFL.x, CFL.y),</span>
<span id="cb25-93"><a href="fdm.html#cb25-93" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;DT&#39;</span> <span class="ot">=</span> DT,</span>
<span id="cb25-94"><a href="fdm.html#cb25-94" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;NT&#39;</span> <span class="ot">=</span> NT</span>
<span id="cb25-95"><a href="fdm.html#cb25-95" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-96"><a href="fdm.html#cb25-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb25-97"><a href="fdm.html#cb25-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-98"><a href="fdm.html#cb25-98" aria-hidden="true" tabindex="-1"></a>plot<span class="fl">.3</span>d <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">nr=</span><span class="dv">3</span>, <span class="at">nc=</span><span class="dv">4</span>, <span class="at">clim=</span><span class="cn">NULL</span>){</span>
<span id="cb25-99"><a href="fdm.html#cb25-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(nr, nc), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb25-100"><a href="fdm.html#cb25-100" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">=</span> <span class="fu">round</span>(<span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">log10</span>(x<span class="sc">$</span>NT), <span class="at">length.out =</span> nc<span class="sc">*</span>nr))</span>
<span id="cb25-101"><a href="fdm.html#cb25-101" aria-hidden="true" tabindex="-1"></a>  z<span class="ot">=</span>x<span class="sc">$</span>z; </span>
<span id="cb25-102"><a href="fdm.html#cb25-102" aria-hidden="true" tabindex="-1"></a>  z[ <span class="fu">is.infinite</span>(<span class="fu">abs</span>(z)) ] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb25-103"><a href="fdm.html#cb25-103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(clim)){</span>
<span id="cb25-104"><a href="fdm.html#cb25-104" aria-hidden="true" tabindex="-1"></a>    clim <span class="ot">=</span> <span class="fu">range</span>(z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-105"><a href="fdm.html#cb25-105" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-106"><a href="fdm.html#cb25-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> idx ){</span>
<span id="cb25-107"><a href="fdm.html#cb25-107" aria-hidden="true" tabindex="-1"></a>    plot3D<span class="sc">::</span><span class="fu">persp3D</span>(<span class="at">z=</span>z[, , i], <span class="at">clim=</span>clim,</span>
<span id="cb25-108"><a href="fdm.html#cb25-108" aria-hidden="true" tabindex="-1"></a>            <span class="at">colvar=</span>z[, , i])</span>
<span id="cb25-109"><a href="fdm.html#cb25-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">&#39;T =&#39;</span>, x<span class="sc">$</span>DT <span class="sc">*</span> i), <span class="at">side=</span> <span class="dv">3</span>, <span class="at">line=</span><span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb25-110"><a href="fdm.html#cb25-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-111"><a href="fdm.html#cb25-111" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="fdm.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot3D)</span>
<span id="cb26-2"><a href="fdm.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_ConfAq2DIm.R&quot;</span>)</span>
<span id="cb26-3"><a href="fdm.html#cb26-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">CA.Implicit</span>(<span class="at">bc1 =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">30</span>,<span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb26-4"><a href="fdm.html#cb26-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">uic =</span> <span class="dv">25</span>,</span>
<span id="cb26-5"><a href="fdm.html#cb26-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">Lxy =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>),</span>
<span id="cb26-6"><a href="fdm.html#cb26-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">Dxy =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>),</span>
<span id="cb26-7"><a href="fdm.html#cb26-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">DD =</span> <span class="fu">rep</span>(<span class="dv">23</span> ,<span class="dv">2</span>),</span>
<span id="cb26-8"><a href="fdm.html#cb26-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">epsilon =</span> <span class="fl">0.001</span>,</span>
<span id="cb26-9"><a href="fdm.html#cb26-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">DT =</span> <span class="dv">25</span>,</span>
<span id="cb26-10"><a href="fdm.html#cb26-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">Tmax =</span> <span class="dv">1000</span></span>
<span id="cb26-11"><a href="fdm.html#cb26-11" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<pre><code>## CFL value = (0.23    0.23)</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="fdm.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.3d</span>(x)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>对比隐式与显式求解法的时间步长和效率：</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="fdm.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb29-2"><a href="fdm.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot3D)</span>
<span id="cb29-3"><a href="fdm.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_ConfAq2DEx.R&quot;</span>)</span>
<span id="cb29-4"><a href="fdm.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Code/ch03/ch3_ConfAq2DIm.R&quot;</span>)</span>
<span id="cb29-5"><a href="fdm.html#cb29-5" aria-hidden="true" tabindex="-1"></a>Tmax <span class="ot">=</span> <span class="fl">1e4</span></span>
<span id="cb29-6"><a href="fdm.html#cb29-6" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">=</span> dy <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb29-7"><a href="fdm.html#cb29-7" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb29-8"><a href="fdm.html#cb29-8" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> <span class="fu">CA.Explicit</span>(<span class="at">Tmax =</span> Tmax, <span class="at">DT =</span> <span class="dv">25</span>, </span>
<span id="cb29-9"><a href="fdm.html#cb29-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Lxy =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>), <span class="at">Dxy =</span> <span class="fu">c</span>(dx, dy),</span>
<span id="cb29-10"><a href="fdm.html#cb29-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ignore.cfl =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## CFL value = (0.23    0.23)</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="fdm.html#cb31-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-2"><a href="fdm.html#cb31-2" aria-hidden="true" tabindex="-1"></a>tu.ex <span class="ot">=</span> t1 <span class="sc">-</span> t0</span>
<span id="cb31-3"><a href="fdm.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="fdm.html#cb31-4" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-5"><a href="fdm.html#cb31-5" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> <span class="fu">CA.Implicit</span>(<span class="at">Tmax =</span> Tmax, <span class="at">DT =</span> <span class="dv">25</span>, </span>
<span id="cb31-6"><a href="fdm.html#cb31-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Lxy =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>), <span class="at">Dxy =</span> <span class="fu">c</span>(dx, dy),</span>
<span id="cb31-7"><a href="fdm.html#cb31-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ignore.cfl =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## CFL value = (0.23    0.23)</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="fdm.html#cb33-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb33-2"><a href="fdm.html#cb33-2" aria-hidden="true" tabindex="-1"></a>tu.im <span class="ot">=</span> t1 <span class="sc">-</span> t0</span>
<span id="cb33-3"><a href="fdm.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="fdm.html#cb33-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>( <span class="st">&#39;Type&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Explicit&#39;</span>, <span class="st">&#39;Implicit&#39;</span>),</span>
<span id="cb33-5"><a href="fdm.html#cb33-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;NT&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(x1<span class="sc">$</span>NT, x2<span class="sc">$</span>NT), </span>
<span id="cb33-6"><a href="fdm.html#cb33-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;DT&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(x1<span class="sc">$</span>DT, x2<span class="sc">$</span>DT),</span>
<span id="cb33-7"><a href="fdm.html#cb33-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;Time&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(tu.ex, tu.im),</span>
<span id="cb33-8"><a href="fdm.html#cb33-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;CFL.X&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(x1<span class="sc">$</span>CFL[<span class="dv">1</span>], x2<span class="sc">$</span>CFL[<span class="dv">1</span>]),</span>
<span id="cb33-9"><a href="fdm.html#cb33-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;CFL.Y&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(x1<span class="sc">$</span>CFL[<span class="dv">2</span>], x2<span class="sc">$</span>CFL[<span class="dv">2</span>])</span>
<span id="cb33-10"><a href="fdm.html#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-11"><a href="fdm.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code></pre></div>
<pre><code>##       Type  NT DT           Time CFL.X CFL.Y
## 1 Explicit 401 25  6.012852 secs  0.23  0.23
## 2 Implicit 401 25 13.724801 secs  0.23  0.23</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="nm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fem.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-FDM.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
