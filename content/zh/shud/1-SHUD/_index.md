---
# Page title
title: 非结构域水文模拟器( The Simulator for Hydrologic Unstructured Domains, SHUD)

# Title for the menu link if you wish to use a shorter link title, otherwise remove this option.
linktitle: 1. SHUD

# Page summary for search engines.
summary: Introduction of the SHUD Model

# Date page published
date: 2020-11-23

# Academic page type (do not modify).
type: book

# Position of this page in the menu. Remove this option to sort alphabetically.
weight: 10

---

![](/media/shud_show.png)

SHUD模型采用有限体积法求解流域水文学常微分方程，获得空间上水的储量和流量。SHUD是多尺度、多过程、数值方法、地表-地下全耦合、分布式水文模型。 

SHUD模型在继承Duffy（1996）所提出的Two-state integral-balance(TSIB)认知模型，并吸收PIHM(Penn State Integrated Hydrologic Model)模型应用经验的基础上，全新开发的数值水文模型。在团队导师Christopher Duffy和Paul Ullrich建议下，将此原创水文模型命名为SHUD (the Simulator for Hydrologic Unstructured Domains），突出模型非结构化特征在水文模拟中的优势。

SHUD模型说明书见：[https://www.shud.xyz/book_cn/](https://www.shud.xyz/book_cn/)

##	SHUD模型的基本结构
SHUD模型利用非结构三角网格表达模拟区域的水平方向空间异质性。模型同时支持规则三角形和Delaunay不规则三角形（Triangular Irregulate Network），但因为流域空间的不规则特点，Delaunay不规则三角形更便于表达。空间上每个三角形单元视为最小坡面计算单元，单元内水文参数具有一致性。
坡面单元在垂直方向上分为三层：地表，未饱和层和饱和层。地表计算植被截留、积雪、下渗和的表

SHUD模型基于Duffy(1996) “两态耦合平衡”认知模型将土壤水层分为未饱和和饱和层，并使用局部平衡公式计算水的流动。

## SHUD模型的特征与优势

-	SHUD模型是一个物理性分布式水文模型，精确描述流域水文物理过程。物理性模型可用于无观测流域的模拟研究。
-	SHUD很好的表达了流域中的空间异质性。水文空间异质性的表达有利于耦合模型研究，例如详细的描述了水从山坡回流的路径，有利于生物化学、污染物运动、地貌变迁、湖泊生态等等方面的耦合研究。
-	SHUD是全耦合模型，在每一时间不步长所有水文状态量都要满足基本求解器的收敛性要求，保证了水文便利在空间上的连续性、一致性和收敛性。
-	SHUD模型使用CVODE 5.0+(Hindmarsh et al., 2005) 作为常微分方程求解器。 CVODE由劳伦斯利弗莫尔国家实验室开发和维护。
-	SHUD可使用灵活的时间和空间步长，适应多种尺度的模拟需求。
-	SHUD支持高空间时间分辨率的洪水模拟，也支持长时间序列的气候和土地利用变化研究。
-	SHUD是开源模型，任何人（非商业用途）都可使用、修改此模型。



## 站在巨人肩上

SHUD的源代码是全新书写的，但其基本的认知模型来自Duffy(1996)提出的“二态耦合平衡”，其数学模型借鉴PIHM（Penn State Integrated Hydrological Model)。SHUD的出现得益于PIHM模型的突破和经验积累。

### PIHM模型简史

Duffy于1996年构建了计算土壤水和地下水动态的“二态耦合平衡”模型(Duffy, 1996)；该模型中，垂直方向分为饱和与非饱和层，局地水量平衡公式耦合计算水的交换。“二态耦合平衡”模型在简化水文动态的同时，保留了自然中时空尺度对产流的响应。 之后Brandes 和Duffy 等 (1998) 继承了“二态耦合平衡”模型并使用FEMWATER实现了数值方法计算山坡-河流尺度上水双向交互。 2004年，曲轶众(Qu 2004)在算法中加入了蒸散发过程和河道计算，并发布了Penn State Integrated Hydrologic Model (PIHM)——**PIHM v1.0**，是PIHM发展中最重要的里程碑，从此PIHM成为流域模拟的通用研究工具应用在不同尺度的流域中。

此后， Kumar， Bhartt和Duffy (Kumar et al., 2009; Kumar and Duffy, 2009) 又相继开发了PIHM v2.0和PIHMgis。 PIHM v2.0增强了模型中陆面过程和土地利用影响水文过程的计算过程。Gopal Bhartt 开发了生成PIHM输入、读取输出和分析结果的软件PIHMgis。PIHMgis分别出现了PIHMgis v2.3和v3.0两个常用版本，PIHMgis v2.3使用了QGIS内核，因此在部分平台上更新困难。 PIHMgis v3.0的支持性更好，可支持Mac或Windows操作系统。Leonard (2013) 开发了HydroTerre平台，为PIHM和其他水文模型提供基础的空间和时间数据。 PIHMgis和HydroTerre的出现极大的推动了PIHM模型在全美和全球的应用。

受益于PIHM模型的诸多优势，PIHM家族出现了若干耦合模型。 例如，Flux-PIHM将NOAH陆面过程模型与PIHM模型耦合，更精确的计算陆面与大气的能量交换、 蒸散发和积雪 (Shi et al., 2015, 2014)。张宇等(Zhang et al. 2016) 开发了LE-PIHM, 模型万年尺度由水文过程造就的地形地貌变化。 RT-PIHM 和 RT-Flux-PIHM(Bao, 2016; Bao et al., 2017)实现了化学反应与PIHM水文过程的耦合。由石宇宁领导的研究正试图将各种PIHM相关模型作为模块统一建立多模块PIHM系统（Multi-Module PIHM， MM-PIHM， https://github.com/PSUmodeling/MM-PIHM）。 除此之外，仍有多个与PIHM耦合的研究正在进行，如与湖泊、农业、经济的耦合研究。

在PIHM模型快速发展的同时，Kumar (Kumar et al., 2009)，在PIHM v2.0基础上设计了 Finite volume-based Integrated Hydrologic Modeling (FIHM)模型，使用二阶精度和三维流动模拟水文过程。

下图展示了PIHM模型的发展和分支。

![Figure_tree](/media/Figure_tree.png)
Figure 1: PIHM和SHUD模型的发展和分支。 PIHMgis和rSHUD分别是支持PIHM和SHUD的数据前后处理工具。 PIHMgis使用C++写成，rSHUD使用R.

### SHUD与PIHM的区别

SHUD模型是PIHM的一个继承者，继承了1996年由Duffy提出的二相耦合概念模型，并且继承了部分PIHM 1.0和2.0的应用经验。之后作者修改了模型中空间结构、物理过程、算法以及编程语言，SHUD模型已经与PIHM在模型物理结构、文件格式和计算方法上不再兼容，因此使用新名称对模型进行命名，以体现新模型自身特点。

SHUD与PIHM的区别：

1. SHUD使用C++面向对象编程，将计算封装起来，避免内存泄露等PIHM常见问题。
2. SHUD使用了不同的坡面与河道的交互。PIHM中河道与两个三角形坡面相邻，带来了四个问题：1. 河道的长度极大的影响和模型的计算单元数量，用户不得不在简单河道和计算单元数量之间做权衡。2. 平原地区的河道绵延曲折，导致大量微小三角形单元和非结构三角形，使得模型计算容易突破库容常数而使得模型变慢。3. 容易出现局部积水点（sink），个别积水点就可以极大的拖慢整个流域的求解速度。 4. 为解决以上问题，模型用户需要反复手动对河流形状进行修改，降低了模型的可重复性和效率。SHUD的河道覆盖在三角形单元之上，坡面和河道水量交换给予河道水位和地下水、地表水的坡度计算，整体计算效率显著提升。
3. SHUD模型中计算入渗、地下水补给和河流交互的公式与PIHM不同。公式的采用基于经验和模型设计时效的需求。未来将会就此进行模型对比，展示两个计算模式的差异。
4. SHUD模型确保了计算中的水量平衡。

在技术层面SHUD模型：

- 支持CVODE 5.0及以上版本
- 支持OpenMP并行计算
- 采用和与PIHM不同的数据结构和算法
- 支持可读性强的输入和输出文件
- 统一的时间序列数据操作
- 指定步长输出模型状态，作为后续模型运行的初始条件。
- 自动检查模型的输入数据和参数的有效性
- 加入模型调试选项，监控每一步长内的非法值和内存操作。



## SHUD对比性优势

### 与非数值方法模型（SWAT和TopModel为代表）对比:

物理性分布式水文模型：基于物理公式（达西定律、理查德方程、简化圣维南方程等）描述流域水文过程。由最基本原理描述来求解整体流域响应，属于自下而上方法，更能表现模拟客观性；即物理性模型优于概念模型和集总式模型。并且物理性模型可用于无观测流域的模拟研究。

- 超高时间分辨率：SHUD模型的时间分辨率为秒至分钟级，对于描述流域变化的快过程有显著优势，例如描述洪水过境、洪水淹没以及水化学过程。尤其是模型内根据变化速度自动调整的自适应时间步长既显著提高模型整体运行效率，又满足数值计算的收敛性要求。以SWAT为代表的模型，通常计算时间分辨率为天。

- 空间连续性：空间连续性有利于耦合研究，例如模型详细描述水从山坡汇流的路径，有利于生物化学、污染物运动、湖泊、生态以及地貌变迁等方面的模型耦合。与之对比，SWAT以HRU为单元计算水的产汇流，但无法描述水从HRU最远点到河流的过程，因而也无法描述污染物在HRU内的传播路径。

- 地表-地下全耦合：比传统模型更真实地表述了地表地下水的交互过程，同时增强了模型在不同流域的通用性。例如传统模型固定了地下水向河流的流向——坡面流向河道，导致无法表达干旱地区河流渗漏补给地下水的过程。SHUD模型的地表地下紧耦合方法中，地下水与河流交互方向由实时水力梯度决定，即水可以双向流动。

- 土地利用的水力学表达：模型中通过蒸发、地表径流、植被物候规律以及土壤特性变化四个方面来体现土地利用，有效地表达了土地利用的水力学特征。对比SWAT模型，其土地利用特征由CN值表达，CN值缺少足够物理性而难以测量；CN值同时包含土壤透水性和土地利用导致的粗糙度与不透水面积，并且难以表达物候特征，因此模型不确定性较大。

### 与其他数值方法水文模型（以ParFlow、SHE、PAWS为代表）对比:

表1总结了SHUD模型与国际相似数值方法水文模型的区别。

- 非结构化空间分割：相比于结构化网格（即矩形网格），非结构网格更有利于表达流域边界、河流和空间特征，其边界条件控制也更符合数值理论（Beven 2012）。在计算上，非结构化网络可以实现模拟空间内重点区域局部加密，或者局部疏松——实现边界条件不变的情况下，有效的控制了数值方法的计算规模。

- 全局隐式求解：流域快过程（地表径流等）与慢过程（地下水流动等）同时求解。保证每一步长水文状态变量都满足收敛性要求，保证了水文变量的连续性、一致性和收敛性。

- 局地和全局水量平衡：有限体积法和程序内算法共同保证了模型局地和全局的水量平衡。

- 灵活的空间分辨率：现有研究结果验证了模型可在厘米至公里级别分辨率上运行，并取得预期的模拟效果。其中厘米分辨率应用于Vauclin等（1979）水槽箱试验模拟中，公里分辨率已应用于实际流域研究中（Shu等2020）。

- 河道与三角形单元的交叉拓扑关系：非结构网格中常见河道与三角形单元的相邻关系，但由于河道自身弯曲绵延，会导致4个问题：（1）为描述河道而产生大量微小三角形单元；（2）河道附近三角形单元出现大钝角，影响模拟精度；（3）河道起始点容易出现异常积水单元；以及（4）通过简化河道后，河道坡度出现负值。SHUD在非结构网络中引入结构网络常用的交叉拓扑关系即可以解决以上问题，显著提高数据制备和模拟效率。

- 开源模型：促进模型自身快速发展，同时有效支撑相关学科耦合研究。当前源代码访问量大于每月40人次。



| 模型名称       | 求解方式     | 耦合方式   | 空间网格 | 数值方法 | 河道与坡面单元关系 | 开源 | 文献                                               |
| -------------- | ------------ | ---------- | -------- | -------- | ------------------ | ---- | -------------------------------------------------- |
| SHUD           | 一阶精度     | 全局隐式   | 非结构   | 有限体积 | 交叉               | 是   | Shu et al. (2020)                                  |
| PIHM           | 一阶精度     | 全局隐式   | 非结构   | 有限体积 | 相邻               | 是   | Qu and Duffy (2007)                                |
| CATHY          | 边界条件交互 | 次序迭代   | 非结构   | 有限元   | 无显式河道单元     |      | Aquanty Inc. (2013)                                |
| HydroGeoSphere | 一阶精度     | 全局隐式   | 非结构   | 有限元   |                    | 否   | Bixio et al. (2002); Camporese et al. (2010)       |
| OpenGeoSys     | 一阶精度     | 次序迭代   | 非结构   | 有限元   | 相邻               | 是   | Delfs et al., (2009, 2012)                         |
| ParFlow        | 压力连续     | 全局隐式   | 结    构 | 有限差分 | 交叉               | 是   | Kollet and Maxwell, (2006); Kollet et al., (2010); |
| PAWS           | 一阶精度     | 非同步连接 | 结构     | 有限差分 | 交叉               | 否   | Shen and Phanikumar, (2010)                        |
| tRIBS          | 一阶精度     | 非同步连接 | 非结构   | 有限元   | 相邻               | 否   | Ivanov et al. (2004)                               |
| MIKE SHE       | 边界条件交互 | 非同步连接 | 结构     | 有限差分 | 交叉               | 否   | Hansen et al. (2013)                               |
